<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The Nimbus Beacon Chain Book</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><strong aria-hidden="true">2.</strong> Hardware requirements</li><li class="chapter-item expanded "><a href="install.html"><strong aria-hidden="true">3.</strong> Install dependencies</a></li><li class="chapter-item expanded "><a href="build.html"><strong aria-hidden="true">4.</strong> Build the beacon node</a></li><li class="chapter-item expanded "><strong aria-hidden="true">5.</strong> Sync an eth1 node</li><li class="chapter-item expanded "><a href="start-syncing.html"><strong aria-hidden="true">6.</strong> Sync the beacon node</a></li><li class="chapter-item expanded "><a href="deposit.html"><strong aria-hidden="true">7.</strong> Make a deposit</a></li><li class="chapter-item expanded "><a href="keys.html"><strong aria-hidden="true">8.</strong> Manage your keys</a></li><li class="chapter-item expanded "><a href="connect-eth2.html"><strong aria-hidden="true">9.</strong> Connect to eth2</a></li><li class="chapter-item expanded "><a href="keep-an-eye.html"><strong aria-hidden="true">10.</strong> Keep an eye on your validator</a></li><li class="chapter-item expanded "><a href="keep-updated.html"><strong aria-hidden="true">11.</strong> Keep Nimbus updated</a></li><li class="chapter-item expanded affix "><li class="part-title">Volume 2</li><li class="chapter-item expanded "><strong aria-hidden="true">12.</strong> Useful pre-genesis checks</li><li class="chapter-item expanded "><a href="troubleshooting.html"><strong aria-hidden="true">13.</strong> Troubleshooting</a></li><li class="chapter-item expanded "><a href="metrics-pretty-pictures.html"><strong aria-hidden="true">14.</strong> Metrics and pretty pictures</a></li><li class="chapter-item expanded "><a href="eth2-stats.html"><strong aria-hidden="true">15.</strong> Network stats + monitoring</a></li><li class="chapter-item expanded "><a href="pi-guide.html"><strong aria-hidden="true">16.</strong> Run your node on a Raspberry Pi</a></li><li class="chapter-item expanded "><a href="graffiti.html"><strong aria-hidden="true">17.</strong> Graffiti the blockchain</a></li><li class="chapter-item expanded "><strong aria-hidden="true">18.</strong> Run just the beacon node</li><li class="chapter-item expanded "><strong aria-hidden="true">19.</strong> Switch between clients</li><li class="chapter-item expanded "><a href="infura-guide.html"><strong aria-hidden="true">20.</strong> Your own Infura endpoint</a></li><li class="chapter-item expanded affix "><li class="part-title">Volume 3</li><li class="chapter-item expanded "><a href="advanced.html"><strong aria-hidden="true">21.</strong> Advanced options</a></li><li class="chapter-item expanded "><a href="api.html"><strong aria-hidden="true">22.</strong> API</a></li><li class="chapter-item expanded "><a href="developers.html"><strong aria-hidden="true">23.</strong> For developers</a></li><li class="chapter-item expanded "><a href="beacon-node-systemd.html"><strong aria-hidden="true">24.</strong> Set up a systemd service</a></li><li class="chapter-item expanded "><strong aria-hidden="true">25.</strong> Windows users</li><li class="chapter-item expanded "><a href="faq.html"><strong aria-hidden="true">26.</strong> FAQ</a></li><li class="chapter-item expanded "><a href="contribute.html"><strong aria-hidden="true">27.</strong> Contribute</a></li><li class="chapter-item expanded "><a href="resources.html"><strong aria-hidden="true">28.</strong> Resources</a></li><li class="chapter-item expanded affix "><li class="part-title">Archived</li><li class="chapter-item expanded "><a href="zinken.html"><strong aria-hidden="true">29.</strong> Become a Zinken validator</a></li><li class="chapter-item expanded "><a href="medalla.html"><strong aria-hidden="true">30.</strong> Become a Medalla validator</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">The Nimbus Beacon Chain Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#the-nimbus-beacon-chain-book" id="the-nimbus-beacon-chain-book">The Nimbus beacon chain book</a></h1>
<blockquote>
<p><strong>Note:</strong> This book is very much a living entity. You'll always be able to find the latest version here: <a href="https://status-im.github.io/nimbus-eth2/">https://status-im.github.io/nimbus-eth2/</a></p>
</blockquote>
<p>The Nimbus beacon chain is a research implementation of the Beacon Chain ‚Äì the core system level chain at the heart of Ethereum 2.0.</p>
<p>This book strives to achieve two purposes:</p>
<ol>
<li>
<p>To attempt to provide a more or less complete <strong>documentation of the Nimbus beacon chain</strong></p>
</li>
<li>
<p>To explain the various ways in which you can <strong>use Nimbus to become a validator on eth2</strong></p>
</li>
</ol>
<h3><a class="header" href="#helpful-resources" id="helpful-resources">Helpful resources</a></h3>
<ul>
<li>
<p><a href="github.com/status-im/nimbus-eth2">nimbus-eth2 repository</a></p>
</li>
<li>
<p><a href="https://github.com/ethereum/eth2.0-specs/tree/v1.0.0-rc.0#phase-0">eth2 specification</a></p>
</li>
<li>
<p><a href="https://benjaminion.xyz/eth2-annotated-spec/phase0/beacon-chain/">Ben Edgington's annotated spec</a> </p>
</li>
<li>
<p><a href="https://github.com/ethereum/annotated-spec/blob/master/phase0/beacon-chain.md">Vitalik's annotated spec</a></p>
</li>
<li>
<p><a href="https://notes.ethereum.org/@djrtwo/Bkn3zpwxB">Danny Ryan's annotated spec</a></p>
</li>
</ul>
<h2><a class="header" href="#introduction" id="introduction">Introduction</a></h2>
<p>The beacon chain is the brain underpinning eth2 -- the next generation of Ethereum. It contains all of the machinery behind eth2's consensus.</p>
<p>You can find a complete introduction to the beacon chain in our <a href="https://our.status.im/two-point-oh-the-beacon-chain/">Ethereum 2.0 blog series</a>.</p>
<h3><a class="header" href="#why-eth2" id="why-eth2">Why eth2?</a></h3>
<p>Eth2 is a multi-year plan to improve the scalability, security, and programmability of Ethereum, without compromising on decentralisation.</p>
<p>In contrast to the Ethereum chain, as it currently stands, eth2 uses proof-of-stake (PoS) to secure its network. And while Ethereum as you know and love it will continue to exist as its own independent proof-of-work chain for a little while to come, the transition towards PoS starts now.</p>
<p>In traditional PoW, block proposers are called <strong><em>miners</em></strong>, whereas in PoS, they are called <strong><em>validators</em></strong>. In essence, <em>miners</em> rely on actual hardware (such as some specifically manufactured mining machines), while <em>validators</em> rely on software (such as Nimbus) and a good network connection.</p>
<h3><a class="header" href="#why-nimbus" id="why-nimbus">Why Nimbus?</a></h3>
<p>In a sentence, Nimbus aims to be an ethereum client for resource-restricted devices. </p>
<p>Because we believe that the largest deployment of Ethereum will be on embedded systems, Nimbus is being designed to perform well on IoT and personal mobile devices, including older smartphones with resource-restricted hardware.</p>
<p>Although Nimbus will support full and archival nodes, its main implementation will be as a light client, with a focus on Proof of Stake and sharding.</p>
<p>All our code is open source; we encourage you to keep track of our activity on <a href="github.com/status-im/nimbus">github.com/status-im/nimbus</a>) and keep up to date with our progress through the <a href="https://our.status.im/tag/nimbus/">Nimbus blog</a>.</p>
<h2><a class="header" href="#get-in-touch" id="get-in-touch">Get in touch</a></h2>
<p>Need help with anything? Join us on <a href="https://join.status.im/nimbus-general">Status</a> and <a href="https://discord.gg/9dWwPnG">Discord</a>!</p>
<h2><a class="header" href="#disclaimer" id="disclaimer">Disclaimer</a></h2>
<p>This documentation assumes Nimbus is in its ideal state. The project is still under active development. Please submit a <a href="https://github.com/status-im/nimbus-eth2/issues">Github issue</a> if you come across a problem.</p>
<!-- > > > TODO:

1. fill up the gitbook content
2. write questions in the faq.md page -->
<h1><a class="header" href="#install-dependencies" id="install-dependencies">Install dependencies</a></h1>
<p>The Nimbus beacon chain can run on Linux, macOS, Windows, and Android. At the moment, Nimbus has to be built from source, which means you'll need to install some dependencies.</p>
<h2><a class="header" href="#time" id="time">Time</a></h2>
<p>The beacon chain relies on your computer having the correct time set (plus or minus 0.5 seconds).</p>
<p>We recommended you run a high quality time service on your computer such as:</p>
<ul>
<li>GPS</li>
<li>NTS (network time security, <a href="https://tools.ietf.org/html/draft-ietf-ntp-using-nts-for-ntp-19">IETF draft</a>)</li>
<li><a href="https://roughtime.googlesource.com/roughtime">Roughtime</a> (google)</li>
</ul>
<p>At a minimum, you should run an NTP client on the server.</p>
<blockquote>
<p><strong>Note:</strong> Most operating systems (including macOS') automatically sync with NTP by default.</p>
</blockquote>
<p>If the above sounds like latin to you, don't worry. You should be fine as long as you haven't messed around with the time and date settings on your computer (they should be set automatically).</p>
<h2><a class="header" href="#external-dependencies" id="external-dependencies">External Dependencies</a></h2>
<ul>
<li>Developer tools (C compiler, Make, Bash, Git)</li>
<li><a href="https://www.pcre.org/">PCRE</a></li>
</ul>
<p>Nimbus will build its own local copy of Nim, so Nim is not an external dependency, </p>
<h2><a class="header" href="#linux" id="linux">Linux</a></h2>
<p>On common Linux distributions the dependencies can be installed with</p>
<pre><code class="language-sh"># Debian and Ubuntu
sudo apt-get install build-essential git libpcre3-dev

# Fedora
dnf install @development-tools pcre

# Archlinux, using an AUR manager for pcre-static
yourAURmanager -S base-devel pcre-static
</code></pre>
<h3><a class="header" href="#macos" id="macos">macOS</a></h3>
<p>Assuming you use <a href="https://brew.sh/">Homebrew</a> to manage packages</p>
<pre><code class="language-sh">brew install pcre cmake
</code></pre>
<h3><a class="header" href="#windows" id="windows">Windows</a></h3>
<p>You can install the developer tools by following the instruction in our <a href="./advanced.html#windows-dev-environment">Windows dev environment section</a>.
We also provide a downloading script for prebuilt PCRE.</p>
<h3><a class="header" href="#android" id="android">Android</a></h3>
<ul>
<li>Install the <a href="https://termux.com">Termux</a> app from FDroid or the Google Play store</li>
<li>Install a <a href="https://wiki.termux.com/wiki/PRoot">PRoot</a> of your choice following the instructions for your preferred distribution.
Note, the Ubuntu PRoot is known to contain all Nimbus prerequisites compiled on Arm64 architecture (the most common architecture for Android devices).</li>
</ul>
<p>Assuming you  use Ubuntu PRoot</p>
<pre><code class="language-sh">apt install build-essential git libpcre3-dev
</code></pre>
<h1><a class="header" href="#build-the-beacon-node" id="build-the-beacon-node">Build the beacon node</a></h1>
<p>The beacon node connects to the eth2 network, manages the blockchain, and provides API's to interact with the beacon chain.</p>
<p>Importantly, you need to have built the beacon node in order to be able to import your keys.</p>
<p><em>Todo: explain relationship between beacon node and validator client</em></p>
<h2><a class="header" href="#prerequisites" id="prerequisites">Prerequisites</a></h2>
<p>Before building and running the application, make sure you've gone through the <a href="./install.html">installed the required dependencies</a>.</p>
<h2><a class="header" href="#building-the-node" id="building-the-node">Building the node</a></h2>
<h4><a class="header" href="#1-clone-the-nim-beacon-chain-repository" id="1-clone-the-nim-beacon-chain-repository">1. Clone the nim beacon chain repository</a></h4>
<pre><code>git clone https://github.com/status-im/nimbus-eth2
cd nimbus-eth2
</code></pre>
<h4><a class="header" href="#2-run-the-beacon-node-build-process" id="2-run-the-beacon-node-build-process">2. Run the beacon node build process</a></h4>
<p>To build the Nimbus beacon node and it's dependencies, run:</p>
<pre><code>make beacon_node
</code></pre>
<h1><a class="header" href="#start-syncing" id="start-syncing">Start syncing</a></h1>
<blockquote>
<p><strong>Note:</strong> Mainnet won't launch before December 1st. If you're planning on making a mainnet <a href="./deposit.html">deposit</a> you can safely skip this step.</p>
</blockquote>
<p>If you're joining a network that has already launched, you need to ensure that your beacon node is <a href="./keep-an-eye.html#keep-track-of-your-syncing-progress">completely synced</a> before submitting your deposit.</p>
<p>This is particularly important if you are joining a network that's been running for a while.</p>
<p>To start syncing <code>medalla</code> , from the <code>nimbus-eth2</code> repository, run:</p>
<pre><code>make medalla
</code></pre>
<h1><a class="header" href="#make-a-deposit" id="make-a-deposit">Make a deposit</a></h1>
<p>The easiest way to get your deposit in is to follow the Ethereum Foundation's launchpad instructions here:</p>
<p><strong>Testnet</strong>:
<a href="https://medalla.launchpad.ethereum.org/">https://medalla.launchpad.ethereum.org/</a></p>
<p><strong>Mainnet</strong>: <a href="https://launchpad.ethereum.org/">https://launchpad.ethereum.org/</a></p>
<blockquote>
<p>‚ö†Ô∏è : If you are making a mainnet deposit make sure you verify that the deposit contract you are interacting with is the correct one. </p>
<p>You should verify that the address is indeed: <a href="https://etherscan.io/address/0x00000000219ab540356cBB839Cbe05303d7705Fa">0x00000000219ab540356cBB839Cbe05303d7705Fa</a></p>
</blockquote>
<p>You may notice that there have been considerable improvements to the launchpad process since the summer.</p>
<p>In particular, the Key Generation section is now much clearer, and you no longer have to install dependencies to get the command line app working.</p>
<p><img src="https://i.imgur.com/UjQ7uRt.png" alt="" /></p>
<p>We won't elaborate on each individual step here, since they are well explained on the site itself. However, there are two points of note:</p>
<h2><a class="header" href="#1-eth1-connection" id="1-eth1-connection">1. Eth1 connection</a></h2>
<p><img src="https://i.imgur.com/81BgR14.png" alt="" /></p>
<p>In the <code>Select Client</code> section you'll first be asked to choose an eth1 client. You need to run an eth1 client in order to process incoming validator deposits from the eth1 chain.</p>
<p><img src="https://i.imgur.com/l5WSGqZ.png" alt="" /></p>
<p>We recommend you choose <code>Go Ethereum</code> (or <code>Geth</code>).</p>
<h2><a class="header" href="#2-block-explorer" id="2-block-explorer">2. Block explorer</a></h2>
<p>Once you've sent off your transaction, you should see the following screen.</p>
<p><img src="https://i.imgur.com/A4IMlhK.png" alt="" /></p>
<p>We recommend you click on <code>Beaconchain</code>. This will open up a window that allows you to keep track of your validator's status.</p>
<p><img src="https://i.imgur.com/JHQblna.png" alt="" /></p>
<p>It's a good idea to bookmark this page.</p>
<h2><a class="header" href="#expected-waiting-time-the-queue" id="expected-waiting-time-the-queue">Expected waiting time (the queue)</a></h2>
<p>Once you send off your transaction(s), your validator will be put in a queue based on deposit time. Getting through the queue may take a few hours or days (assuming the chain is finalising). No validators are accepted into the validator set while the chain isn't finalising.</p>
<blockquote>
<p><strong>Note:</strong> If you are making a mainnet deposit this is all you need to do at this stage. If you haven't done so already, we recommend you make a testnet deposit too, and continue with the rest of the book. This will give you a chance to play around with Nimbus in a risk-free environment.</p>
</blockquote>
<h1><a class="header" href="#manage-your-keys" id="manage-your-keys">Manage your keys</a></h1>
<blockquote>
<p>‚ö†Ô∏è  This page concerns the Medalla testnet only. If you have made a mainnet deposit, you do not need to import your keys into Nimbus quite yet. </p>
</blockquote>
<h2><a class="header" href="#import" id="import">Import</a></h2>
<p>To import your signing key(s) into Nimbus, from the <code>nimbus-eth2</code> directory run:</p>
<pre><code> build/beacon_node deposits import  --data-dir=build/data/shared_medalla_0 &lt;YOUR VALIDATOR KEYS DIRECTORY&gt;
</code></pre>
<p>Replacing <code>&lt;YOUR VALIDATOR KEYS DIRECTORY&gt;</code> with the full pathname of the <code>validator_keys</code> directory that was created when you generated your keys using the <a href="https://medalla.launchpad.ethereum.org/">Medalla Launchpad</a> <a href="https://github.com/ethereum/eth2.0-deposit-cli/releases/">command line app</a>.</p>
<blockquote>
<p><strong>Tip:</strong> run <code>pwd</code> in your <code>validator_keys</code> directory to print the full pathname to the console.</p>
</blockquote>
<p>You'll be asked to enter the password you created to encrypt your keystore(s).</p>
<p>Don't worry, this is entirely normal. Your validator client needs both your signing keystore(s) and the password encrypting it to import your <a href="https://blog.ethereum.org/2020/05/21/keys/">key</a> (since it needs to decrypt the keystore in order to be able to use it to sign on your behalf).</p>
<h2><a class="header" href="#storage" id="storage">Storage</a></h2>
<p>When you import your keys into Nimbus, your validator signing key(s) are stored in the <code>build/data/shared_medalla_0/</code> folder, under <code>secrets</code> and <code>validators</code> - <strong>make sure you keep these folders backed up somewhere sage.</strong></p>
<p>The <code>secrets</code> folder contains the common secret that gives you access to all your validator keys.</p>
<p>The <code>validators</code> folder contains your signing keystore(s) (encrypted keys). Keystores are used by validators as a method for exchanging keys. For more on keys and keystores, see <a href="https://blog.ethereum.org/2020/05/21/keys/">here</a>.</p>
<blockquote>
<p><strong>Note:</strong> The Nimbus client will only ever import your signing key -- in any case, if you used the deposit launchpad, this is the only key you should have (thanks to the way these keys are derived, you can generate the withdrawal key from your mnemonic whenever you wish to withdraw).</p>
</blockquote>
<h2><a class="header" href="#export" id="export">Export</a></h2>
<p><em>Todo</em></p>
<h1><a class="header" href="#connect-to-eth2" id="connect-to-eth2">Connect to eth2</a></h1>
<blockquote>
<p>‚ö†Ô∏è  This page concerns the Medalla testnet only. If you have made a mainnet deposit, you do not need to connect to eth2 quite yet. Mainnet <a href="https://hackmd.io/@benjaminion/genesis">Genesis</a> date has been set to <a href="https://blog.ethereum.org/2020/11/04/eth2-quick-update-no-19/">December 1st</a>. This page will be updated nearer the time.</p>
</blockquote>
<p>To connect to the Medalla testnet, from the <code>nimbus-eth2</code> repository run:</p>
<pre><code>make medalla
</code></pre>
<blockquote>
<p><strong>Note:</strong> If your beacon node is already running, you'll need to shut it down gracefully (<code>Ctrl+c</code>) and re-run the above command.</p>
</blockquote>
<p>This will build Nimbus and its dependencies, and connect you to the eth2 network.
You should see that the beacon node has launched with your validator attached:</p>
<pre><code>WRN 2020-08-03 16:24:17.950+02:00 Validator not in registry (yet?)           topics=&quot;beacval&quot; tid=11677993 file=validator_duties.nim:53 pubKey=a9c4df36
INF 2020-08-03 16:24:17.951+02:00 Local validator attached                   tid=11677993 file=validator_pool.nim:21 pubKey=a9c4df36 validator=a9c4df36
INF 2020-08-03 16:24:17.951+02:00 Local validators attached                  topics=&quot;beacval&quot; tid=11677993 file=validator_duties.nim:61 count=1
INF 2020-08-03 16:24:17.958+02:00 Starting beacon node                       topics=&quot;beacnde&quot; tid=11677993 file=beacon_node.nim:875 version=&quot;0.5.0 (31b33907)&quot; nim=&quot;Nim Compiler Version 1.2.6 [MacOSX: amd64] (bf320ed1)&quot; timeSinceFinalization=81350 head=ebe49843:0 finalizedHead=ebe49843:0 SLOTS_PER_EPOCH=32 SECONDS_PER_SLOT=12 SPEC_VERSION=0.12.2 dataDir=build/data/shared_medalla_0 pcs=start_beacon_node
</code></pre>
<blockquote>
<p><strong>Note:</strong> when you run <code>make medalla</code>, the beacon node launches with an Infura endpoint supplied by us. This endpoint is passed through the <code>web3-url</code> option (which takes as input the url of the web3 server from which you'd like to observe the eth1 chain). </p>
<p>Because Infura caps the requests per endpoint per day to 100k, and all Nimbus nodes use the same Infura endpoint by default, it can happen that our Infura endpoint is overloaded (i.e the requests on a given day reach the 100k limit). If this happens, all requests to Infura using the default endpoint will fail, which means your node will stop processing new deposits.</p>
<p>To pass in your own Infura endpoint, you'll need to run:</p>
<pre><code>make NODE_PARAMS=&quot;--web3-url=&lt;YOUR_WEBSOCKET_ENDPOINT&gt;&quot; medalla
</code></pre>
<p>Importantly, the endpoint must be a websocket (<code>wss</code>) endpoint, not <code>https</code>. If you're not familiar with Infura, we recommend reading through our <a href="./infura-guide">Infura guide</a>, first.</p>
<p>P.S. We are well aware that Infura is less than ideal from a decentralisation perspective. As such we are in the process of changing our default to <a href="https://geth.ethereum.org/docs/install-and-build/installing-geth">Geth</a> (with Infura as a fallback). For some rough notes on how to use Geth with Nimbus, see <a href="https://gist.github.com/onqtam/aaf883d46f4dab1311ca9c160df12fe4">here</a> (we will be adding more complete instructions very soon).</p>
</blockquote>
<blockquote>
<p><strong>Tip:</strong> to üé® on the <a href="https://medalla.beaconcha.in/graffitiwall">graffitwall</a>, pass the graffiti parameter like this:</p>
<pre><code>make NODE_PARAMS=&quot;--graffiti='&lt;YOUR_GRAFFITI&gt;'&quot; medalla
</code></pre>
</blockquote>
<p>For a more complete list of the options available, see <a href="./advanced.html">here</a>.</p>
<h1><a class="header" href="#keep-an-eye-on-your-validator" id="keep-an-eye-on-your-validator">Keep an eye on your validator</a></h1>
<p>The best way to keep track of your validator's status is using the <code>beaconcha.in</code> explorer (click on the orange magnifying glass at the very top and paste in your validator's public key):</p>
<ul>
<li><strong>Testnet:</strong> <a href="https:/medalla.beaconcha.in">medalla.beaconcha.in</a> </li>
<li><strong>Mainnet:</strong> <a href="https://beaconcha.in/">beaconcha.in</a></li>
</ul>
<p>If you deposit after the <a href="https://hackmd.io/@benjaminion/genesis">genesis</a> state was decided, your validator(s) will be put in a queue based on deposit time, and will slowly be inducted into the validator set after genesis. Getting through the queue may take a few hours or a day or so.</p>
<p>You can even create an account (<a href="https://medalla.beaconcha.in/register">testnet link</a>, <a href="https://beaconcha.in/register">mainnet link</a>) to add alerts and keep track of your validator's performance (<a href="https://medalla.beaconcha.in/dashboard">testnet link</a>, <a href="https://beaconcha.in/dashboard">mainnet link</a>).</p>
<hr />
<blockquote>
<p>‚ö†Ô∏è  The rest of this page concerns the Medalla testnet only. If you have made a mainnet deposit, you do not need to run Nimbus quite yet. Mainnet <a href="https://hackmd.io/@benjaminion/genesis">Genesis</a> date has been set to <a href="https://blog.ethereum.org/2020/11/04/eth2-quick-update-no-19/">December 1st</a>. This page will be updated nearer the time.</p>
</blockquote>
<h2><a class="header" href="#make-sure-your-validator-is-attached" id="make-sure-your-validator-is-attached">Make sure your validator is attached</a></h2>
<p>On startup, you should see a log message that reads <code>Local validators attached</code>. This has a <code>count</code> field which should correctly reflect the number of validators you wish to run.</p>
<pre><code>{&quot;lvl&quot;:&quot;NOT&quot;,&quot;ts&quot;:&quot;2020-10-26 10:16:51.365+00:00&quot;,&quot;msg&quot;:&quot;Local validators attached &quot;,&quot;topics&quot;:&quot;beacval&quot;,&quot;tid&quot;:12291,&quot;file&quot;:&quot;validator_duties.nim:65&quot;,&quot;count&quot;:1}
</code></pre>
<p><em>In the above case, the <code>count</code> field reads <code>1</code>, which means 1 validator has successfully attached to the beacon node.</em></p>
<h2><a class="header" href="#keep-track-of-your-syncing-progress" id="keep-track-of-your-syncing-progress">Keep track of your syncing progress</a></h2>
<p>To keep track of your syncing progress, have a look at the output at the very bottom of the terminal window in which your validator is running. You should see something like:</p>
<pre><code>peers: 35 ‚ùØ finalized: ada7228a:8765 ‚ùØ head: b2fe11cd:8767:2 ‚ùØ time: 9900:7 (316807) ‚ùØ sync: wPwwwwwDwwDPwPPPwwww:7:4.0627 (280512)
</code></pre>
<p>Where:</p>
<ul>
<li><code>peers</code> tells you how many peers you're currently connected to (in the above case, 35 peers)</li>
<li><code>finalized</code> tells you the most recent finalized epoch you've synced to so far (the 8765th epoch)</li>
<li><code>head</code> tells you the most recent slot you've synced to so far (the 2nd slot of the 8767th epoch)</li>
<li><code>time</code> tells you the current time since Genesis (the 7th slot of the 9900th epoch -- or equivalently, the 316,807th slot)</li>
<li><code>sync</code> tells you how fast you're syncing (4.0627 blocks per second), how many blocks you've synced so far (280,512), along with information about 20 sync workers linked to the 20 most performant peers you are currently connected to (represented by a string of letters and a number).</li>
</ul>
<p>To dig into <code>sync</code> a little:</p>
<pre><code>sync: &lt;sync worker map&gt;:&lt;number of active workers&gt;:&lt;current syncing speed in blocks/second&gt;
</code></pre>
<p>The string of letters -- what we call the <code>sync worker map</code> (in the above case represented by <code>wPwwwwwDwwDPwPPPwwww</code>) represents the status of the sync workers mentioned above, where:</p>
<pre><code>    s - sleeping (idle),
    w - waiting for a peer from PeerPool,
    R - requesting blocks from peer
    D - downloading blocks from peer
    P - processing/verifying blocks
    U - updating peer's status information
</code></pre>
<p>The number following it (in the above case represented by <code>7</code>) represents the number of workers that are currently active (i.e not sleeping or waiting for a peer).</p>
<h2><a class="header" href="#eth2stats" id="eth2stats">eth2stats</a></h2>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Zinken eth2stats is up!<a href="https://t.co/3LsvmN3NXN">https://t.co/3LsvmN3NXN</a><br><br>One good pre-genesis check is to query your local node&#39;s API to see if you have peers (you should!)<br><br>If you hook up to eth2stats, you can easily monitor this metric from anywhere üëÄ</p>&mdash; dannyryan (@dannyryan) <a href="https://twitter.com/dannyryan/status/1314280942651858945?ref_src=twsrc%5Etfw">October 8, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p><em>Todo</em></p>
<h1><a class="header" href="#keep-nimbus-updated" id="keep-nimbus-updated">Keep Nimbus updated</a></h1>
<p>Make sure you stay on the lookout for any critical updates to Nimbus. This best way to do so is through the <strong>announcements</strong> channel on our <a href="https://discord.com/invite/XRxWahP">discord</a>.</p>
<p>To update to the latest version, run:</p>
<pre><code>git pull &amp;&amp; make update
</code></pre>
<blockquote>
<p><strong>Note:</strong> If your beacon node is already running, you'll need to disconnect and reconnect for the changes to take effect.</p>
</blockquote>
<h1><a class="header" href="#troubleshooting" id="troubleshooting">Troubleshooting</a></h1>
<blockquote>
<p>‚ö†Ô∏è  This page concerns the Medalla testnet. If you have made a mainnet deposit, you do not need to connect to eth2 quite yet. Mainnet <a href="https://hackmd.io/@benjaminion/genesis">Genesis</a> date has been set to <a href="https://blog.ethereum.org/2020/11/04/eth2-quick-update-no-19/">December 1st</a>. This page will be updated nearer the time.</p>
</blockquote>
<p>As it stands, we are continuously making improvements to both stability and memory usage. So please make sure you keep your client up to date! This means restarting your node and updating your software regularly from the <code>master</code> branch. If you can't find a solution to your problem here, feel free to hit us up on our <a href="https://discord.com/invite/XRxWahP">discord</a>!</p>
<blockquote>
<p><strong>Note:</strong> While the <code>master</code> branch of the <code>nimbus-eth2</code> repository is more stable, the latest updates happen in the <code>devel</code> branch which is (usually) merged into master every week on Tuesday. If you choose to run Nimbus directly from the <code>devel</code> branch, be prepared for instabilities!</p>
</blockquote>
<p>To update and restart, run <code>git pull</code>, <code>make update</code>, followed by <code>make medalla</code>:</p>
<pre><code>cd nimbus-eth2
git pull
make update # Update dependencies
make medalla # Restart using same keys as last run
</code></pre>
<p>If you find that <code>make update</code> causes the console to hang for too long, try running <code>make update V=1</code> or <code>make update V=2</code> instead (these will print a more verbose output to the console which may make it easier to diagnose the problem).</p>
<blockquote>
<p><strong>Note:</strong> rest assured that when you restart the beacon node, the software will resume from where it left off, using the validator keys you have already imported.</p>
</blockquote>
<h3><a class="header" href="#starting-over" id="starting-over">Starting over</a></h3>
<p>The directory that stores the blockchain data of the testnet is <code>build/data/shared_medalla_0</code> (if you're connecting to another testnet, replace <code>medalla</code> with that testnet's name). Delete this folder to start over (for example, if you started building medalla with the wrong private keys).</p>
<h3><a class="header" href="#syncing" id="syncing">Syncing</a></h3>
<p>If you‚Äôre experiencing sync problems,  we recommend running <code>make clean-medalla</code> to delete the database and restart your sync (make sure you‚Äôve updated to the latest <code>master</code> first though).</p>
<blockquote>
<p><strong>Warning</strong>: <code>make clean-medalla</code> will erase all of your syncing progress so far, so it should only be used as a last resort -- if your client gets stuck for a long time (because it's unable to find the right chain and/or stay with the same head value) and a normal restart doesn't improve things.</p>
</blockquote>
<h3><a class="header" href="#pruning-the-database" id="pruning-the-database">Pruning the database</a></h3>
<p>If you're running out of storage, you can <a href="https://blog.ethereum.org/2015/06/26/state-tree-pruning/">prune</a> the database of unnecessary blocks and states by running:</p>
<pre><code>make ncli_db
build/ncli_db pruneDatabase --db=build/data/shared_medalla_0/db --verbose=true
</code></pre>
<p>This will create <code>nbc_pruned.sqlite3</code> files in <code>build/data/shared_medalla_0/db</code>, which you can use in place of the orginal <code>nbc.sqlite3</code> files. We recommend you hold onto the originals until you've verified that your validator is behaving as expected with the pruned files.</p>
<p>Options:</p>
<ul>
<li><code>--keepOldStates</code> (boolean):  Keep pre-finalisation states; defaults to <code>true</code>.</li>
<li><code>--verbose</code> (boolean): Print a more verbose output to the console; defaults to <code>false</code>.</li>
</ul>
<h3><a class="header" href="#keeping-up-with-the-head-of-the-chain" id="keeping-up-with-the-head-of-the-chain">Keeping up with the head of the chain</a></h3>
<p>As it stands, logging seems to be slowing down the client,  and quite a few users are experiencing trouble either catching up or keeping up with the head of the chain. You can use either the <code>LOG_LEVEL=INFO</code> or <code>LOG_LEVEL=NOTICE</code> options to reduce verbosity and speed up the client (<code>NOTICE</code> is even less verbose than <code>INFO</code>).</p>
<pre><code>make LOG_LEVEL=INFO medalla
</code></pre>
<h3><a class="header" href="#low-peer-counts" id="low-peer-counts">Low peer counts</a></h3>
<p>If you're experiencing a low peer count, you may be behind a firewall. Try restarting your client and passing <code>NODE_PARAMS=&quot;--nat:\&quot;extip:$EXT_IP_ADDRESS\&quot;&quot;</code> as an option to <code>make medalla</code>, where <code>$EXT_IP_ADDRESS</code> is your real IP. For example, if your real IP address is <code>35.124.65.104</code>, you'd run:</p>
<pre><code>make NODE_PARAMS=&quot;--nat:\&quot;extip:35.124.65.104\&quot;&quot; medalla
</code></pre>
<h3><a class="header" href="#address-already-in-use-error" id="address-already-in-use-error">Address already in use error</a></h3>
<p>If you're seeing an error that looks like:</p>
<pre><code>Error: unhandled exception: (98) Address already in use [TransportOsError]
</code></pre>
<p>It's probably because you're running multiple validators -- and the default base port <code>9000</code> is already in use.</p>
<p>To change the base port, run:</p>
<pre><code>make BASE_PORT=9100 medalla
</code></pre>
<p>(You can replace <code>9100</code> with a port of your choosing)</p>
<h3><a class="header" href="#eth1-chain-monitor-failure" id="eth1-chain-monitor-failure">Eth1 chain monitor failure</a></h3>
<p>If you're seeing one or more error messages that look like the following:</p>
<pre><code>ERR 2020-09-29 14:04:33.313+02:00 Eth1 chain monitor failure, restarting      tid=8941404 
file=eth1_monitor.nim:812 err=&quot;{\&quot;code\&quot;:-32005,
\&quot;data\&quot;:{\&quot;rate\&quot;:{\&quot;allowed_rps\&quot;:1,
\&quot;backoff_seconds\&quot;:24,
\&quot;current_rps\&quot;:22.5},
\&quot;see\&quot;:\&quot;https://infura.io/dashboard\&quot;},
\&quot;message\&quot;:\&quot;daily request count exceeded, request rate limited\&quot;}&quot;
</code></pre>
<p>This means that our Infura endpoint is overloaded (in other words, the requests on a given day have reached the 100k free tier limit). </p>
<p>You can fix this by passing in <a href="./infura-guide.html">your own Infura endpoint</a>.</p>
<p>To do so, run: </p>
<pre><code>make NODE_PARAMS=&quot;--web3-url=&lt;YOUR_WEBSOCKET_ENDPOINT&gt;&quot; medalla
</code></pre>
<p>Importantly, make sure you pass in a websocket (<code>wss</code>) endpoint, not <code>https</code>. If you're not familiar with Infura, we recommend reading through our <a href="./infura-guide">Infura guide</a> first.</p>
<h3><a class="header" href="#running-multiple-nodes-on-the-same-computer" id="running-multiple-nodes-on-the-same-computer">Running multiple nodes on the same computer</a></h3>
<p>If you're running different testnets on the same computer, you'll need to specify a different <code>NODE_ID</code> to avoid port conflicts (the default is <code>NODE_ID=0</code>).</p>
<p>For example, to run <code>medalla</code> and <code>zinken</code> at the same time:</p>
<pre><code>make medalla NODE_ID=0 # the default
make zinken NODE_ID=1
</code></pre>
<h1><a class="header" href="#metrics-and-pretty-pictures" id="metrics-and-pretty-pictures">Metrics and pretty pictures</a></h1>
<blockquote>
<p>‚ö†Ô∏è  This page concerns the Medalla testnet. If you have made a mainnet deposit, you do not need to connect to eth2 quite yet. Mainnet <a href="https://hackmd.io/@benjaminion/genesis">Genesis</a> date has been set to <a href="https://blog.ethereum.org/2020/11/04/eth2-quick-update-no-19/">December 1st</a>. This page will be updated nearer the time.</p>
</blockquote>
<p>In this page we'll cover how to use  Grafana and Prometheus to help you visualise important real-time metrics concerning your validator and/or beacon node.</p>
<p>Prometheus is an open-source systems monitoring and alerting toolkit. It runs as a service on your computer and its job is to capture metrics. You can find more information about Prometheus <a href="https://prometheus.io/docs/introduction/overview/">here</a>.</p>
<p>Grafana is a tool for beautiful dashboard monitoring that works well with Prometheus. You can learn more about Grafana <a href="https://github.com/grafana/grafana">here</a>.</p>
<h2><a class="header" href="#simple-metrics" id="simple-metrics">Simple metrics</a></h2>
<p>The easiest way to see metrics concerning your validator / node is to run the beacon node with the <code>NIMFLAGS=&quot;-d:insecure&quot;</code> flag. For example, to enable metrics for a <code>medalla</code> validator, run:</p>
<pre><code>make NIMFLAGS=&quot;-d:insecure&quot; medalla
</code></pre>
<blockquote>
<p><strong>Note:</strong> Metrics are not included in the binary by default. The <code>NIMFLAGS=&quot;-d:insecure&quot;</code> is needed because we consider the HTTP server that needs to start to serve the metrics to be insecure (without this flag it won't launch properly). As such, we recommend you make sure port 8008 is protected.</p>
</blockquote>
<p>Now visit <a href="http://127.0.0.1:8008/metrics">http://127.0.0.1:8008/metrics</a> to see the raw metrics. You should see a plaintext page that looks something like this:</p>
<pre><code># HELP nim_runtime_info Nim runtime info
# TYPE nim_runtime_info gauge
nim_gc_mem_bytes 6275072.0
nim_gc_mem_occupied_bytes 1881384.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;KeyValuePairSeq[digest.Eth2Digest, block_pools_types.BlockRef]&quot;} 25165856.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;BlockRef&quot;} 17284608.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;string&quot;} 6264507.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;seq[SelectorKey[asyncdispatch.AsyncData]]&quot;} 409632.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;OrderedKeyValuePairSeq[Labels, seq[Metric]]&quot;} 122720.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;Future[system.void]&quot;} 79848.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;anon ref object from /Users/hackingresearch/nimbus/clone/nim-beacon-chain/vendor/nimbus-build-system/vendor/Nim/lib/pure/asyncmacro.nim(319, 33)&quot;} 65664.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;anon ref object from /Users/hackingresearch/nimbus/clone/nim-beacon-chain/vendor/nimbus-build-system/vendor/Nim/lib/pure/asyncnet.nim(506, 11)&quot;} 43776.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;seq[byte]&quot;} 37236.0
nim_gc_heap_instance_occupied_bytes{type_name=&quot;seq[TrustedAttestation]&quot;} 29728.0

...
</code></pre>
<p>Unfortunately, this simple method only offers one snapshot in time (you'll need to keep refreshing to see the data update) which means it's impossible to see a useful history of the metrics. In short, it's far from optimal from an information design point of view.</p>
<p>In order to settle on a better solution, we'll need the help of two external projects -- Prometheus and Grafana.</p>
<h2><a class="header" href="#prometheus-and-grafana" id="prometheus-and-grafana">Prometheus and Grafana</a></h2>
<p>The following steps will take you through how to use Prometheus and Grafana to spin up a beautiful and useful monitoring dashboard for your validator and beacon node.</p>
<h3><a class="header" href="#steps" id="steps">Steps</a></h3>
<h4><a class="header" href="#1-download-prometheus" id="1-download-prometheus">1. Download Prometheus</a></h4>
<p>Download and extract the <a href="https://prometheus.io/download/">latest release</a> of Prometheus for your platform:</p>
<pre><code>tar xvfz prometheus-*.tar.gz
cd prometheus-*
</code></pre>
<blockquote>
<p><strong>Note:</strong> If you use a package manager, you can also download Prometheus that way -- for example <code>apt-get install prometheus</code> on Ubuntu, or <code>brew install prometheus</code> on MacOS, should do the trick.</p>
</blockquote>
<h4><a class="header" href="#2-copy-the-binary" id="2-copy-the-binary">2. Copy the binary</a></h4>
<p>The Prometheus server is a single binary called prometheus (or prometheus.exe on Microsoft Windows). Copy it over to <a href="https://unix.stackexchange.com/questions/4186/what-is-usr-local-bin"><code>/usr/local/bin</code></a></p>
<pre><code>cp prometheus-2.20.1.linux-amd64/prometheus /usr/local/bin/
</code></pre>
<h4><a class="header" href="#3-run-prometheus-with-the-default-configuration-file" id="3-run-prometheus-with-the-default-configuration-file">3. Run Prometheus with the default configuration file</a></h4>
<p>Prometheus relies on a YAML configuration file to let it know where, and how often, to scrape data.</p>
<p><code>nimbus-eth2</code> generates an appropriate configuration file (<code>prometheseus.yml</code>) when you build the beacon node. If you're running the <code>medalla</code> testnet you'll find this in <code>build/data/shared_medalla_0</code>.</p>
<p>To run Prometheus with the default config file:</p>
<pre><code>cd build/data/shared_medalla_0
prometheus --config.file=./prometheus.yml --storage.tsdb.path=./prometheus
# when starting multiple nodes at the same time, just use the config file from the one with the highest ID
</code></pre>
<h4><a class="header" href="#4-download-grafana" id="4-download-grafana">4. Download Grafana</a></h4>
<p><a href="(https://grafana.com/grafana/download?platform=linux)">Download the latest release</a> of Grafana for your platform.</p>
<blockquote>
<p><strong>Note:</strong> If you use a package manager, you can also download Grafana that way -- for example <code>apt-get install grafana</code> on Ubuntu, or <code>brew install grafana</code> on MacOS, should do the trick.</p>
</blockquote>
<h4><a class="header" href="#5-install-and-start-grafana" id="5-install-and-start-grafana">5. Install and start Grafana</a></h4>
<p>Follow <a href="https://grafana.com/docs/grafana/latest/installation/">the instructions for your platform</a> to install and start Grafana.</p>
<h4><a class="header" href="#6-configure-login" id="6-configure-login">6. Configure login</a></h4>
<p>Go to <a href="http://localhost:3000/">http://localhost:3000/</a>, you should see a Grafana login screen that looks like this</p>
<p><img src="https://i.imgur.com/jcP1qWl.png" alt="" /></p>
<p>Type in <code>admin</code> for both the username and password. You'll be asked to change the password (we recommend you do so).</p>
<h4><a class="header" href="#7-add-a-data-source" id="7-add-a-data-source">7. Add a data source</a></h4>
<p>Hover your mouse over the gear icon in the left menu bar, and click on the <code>Data Sources</code> option in the sub-menu that pops up.</p>
<p><img src="https://i.imgur.com/0Xsgx61.png" alt="" /></p>
<p>Now click on the <code>Add Data Source</code> button in the center of the screen</p>
<p><img src="https://i.imgur.com/YRVJjdD.png" alt="" /></p>
<p>Select <code>Prometheus</code></p>
<p><img src="https://i.imgur.com/YpwThOr.png" alt="" /></p>
<p>Enter <code>http://localhost:9090</code> in the URL field</p>
<p><img src="https://i.imgur.com/PtVOnur.png" alt="" /></p>
<p>Scroll to the bottom and click on <code>Save and Test</code></p>
<p><img src="https://i.imgur.com/GJVdwaK.png" alt="" /></p>
<p>If everything is working correctly you should see a green <code>Data source is working</code> box pop up</p>
<p><img src="https://i.imgur.com/vf5ahNA.png" alt="" /></p>
<h4><a class="header" href="#8-import-a-dashboard" id="8-import-a-dashboard">8. Import a dashboard</a></h4>
<p>Now, let's import a dashboard; hover your mouse over the <code>+</code> icon in the left menu bar and select <code>import</code> from the pop-up menu</p>
<p><img src="https://i.imgur.com/WnnAcUR.png" alt="" /></p>
<p>Click on <code>Upload JSON file</code></p>
<p><img src="https://i.imgur.com/l65ICZ2.png" alt="" /></p>
<p>Select the <code>beacon_nodes_Grafana_dashboard.json</code>  from the <code>nimbus-eth2/grafana/</code> folder and click on <code>Import</code></p>
<p><img src="https://i.imgur.com/SoU5Isz.png" alt="" /></p>
<p>You'll be directed to the dashboard where you'll be able to gain insights into the performance of <code>nimbus-eth2</code> and your validators</p>
<p><img src="https://i.imgur.com/aIfJ1iT.png" alt="" /></p>
<blockquote>
<p><strong>Note:</strong> the dashboard is very much a work in progress. Some of the highlights right now include received and proposed blocks, received and sent attestations, peers, memory and cpu usage stats. But keep an eye out for additional metrics in the near future.</p>
</blockquote>
<p>And voila! That's all there is to it :)</p>
<h2><a class="header" href="#enabling-mobile-alerts" id="enabling-mobile-alerts">Enabling mobile alerts</a></h2>
<h3><a class="header" href="#telegram" id="telegram">Telegram</a></h3>
<p>TODO</p>
<h3><a class="header" href="#discord" id="discord">Discord</a></h3>
<p>TODO</p>
<h2><a class="header" href="#additional-resources" id="additional-resources">Additional resources</a></h2>
<ul>
<li><a href="https://medium.com/@SomerEsat/guide-to-staking-on-ethereum-2-0-ubuntu-medalla-nimbus-5f4b2b0f2d7c">Guide to Staking on Ethereum 2.0 (Ubuntu/Medalla/Nimbus)</a>: a guide by an outside contributer that contains some very informative sections on both Prometheus and Grafana. We strongly recommend reading through the relevant sections if you're using a linux device and/or using <code>systemd</code>.</li>
<li><a href="https://metrics.status.im/d/pgeNfj2Wz23/nimbus-testnet3?orgId=1&amp;from=now-6h&amp;to=now&amp;var-container=beacon-node-testnet3&amp;var-instance=node-03.aws-eu-central-1a.nimbus.test">Our dashboard</a> (AWS Medalla nodes)</li>
</ul>
<h1><a class="header" href="#network-stats-and-monitoring" id="network-stats-and-monitoring">Network stats and monitoring</a></h1>
<blockquote>
<p>‚ö†Ô∏è  This page concerns the Medalla testnet. If you have made a mainnet deposit, you do not need to connect to eth2 quite yet. Mainnet <a href="https://hackmd.io/@benjaminion/genesis">Genesis</a> date has been set to <a href="https://blog.ethereum.org/2020/11/04/eth2-quick-update-no-19/">December 1st</a>. This page will be updated nearer the time.</p>
</blockquote>
<p>eth2stats is a network monitoring suite for your beacon node + validator client.</p>
<p>It consists of a <a href="https://github.com/Alethio/eth2stats-client">command-line-interface</a> (to help you query your node's API), and an <a href="https://eth2stats.io/medalla-testnet">associated website</a>(which allows you to monitor your node from anywhere).</p>
<p>In this guide we'll take you through how to get eth2stats running on your local machine, and how to hook your node up to the website.</p>
<h2><a class="header" href="#prerequisites-1" id="prerequisites-1">Prerequisites</a></h2>
<p>Knowledge of both <a href="https://www.learnenough.com/git-tutorial/getting_started">git</a> and <a href="https://www.learnenough.com/command-line-tutorial/basics">command line basics</a>, and a working <a href="https://golang.org/dl/">Golang</a> environment.</p>
<h2><a class="header" href="#guide" id="guide">Guide</a></h2>
<h3><a class="header" href="#1-clone-the-eth2stats-repository" id="1-clone-the-eth2stats-repository">1. Clone the eth2stats repository</a></h3>
<pre><code>git clone https://github.com/Alethio/eth2stats-client.git
</code></pre>
<h3><a class="header" href="#2-move-into-the-repository" id="2-move-into-the-repository">2. Move into the repository</a></h3>
<pre><code>cd eth2stats-client
</code></pre>
<h3><a class="header" href="#3-build-the-executable" id="3-build-the-executable">3. Build the executable</a></h3>
<pre><code>make build
</code></pre>
<h3><a class="header" href="#4-add-your-node-to-eth2statsio" id="4-add-your-node-to-eth2statsio">4. Add your node to eth2stats.io</a></h3>
<h4><a class="header" href="#1-click-on-add-node" id="1-click-on-add-node">1. Click on add node</a></h4>
<p><img src="https://i.imgur.com/zPkMahy.png" alt="" /></p>
<h4><a class="header" href="#2-configure-name-and-client-type" id="2-configure-name-and-client-type">2. Configure name and client type</a></h4>
<p><img src="https://i.imgur.com/nA3AVnT.png" alt="" /></p>
<h4><a class="header" href="#3-copy-the-command" id="3-copy-the-command">3. Copy the command</a></h4>
<p>Click on <code>Compile from source</code> and copy the command at the bottom.</p>
<p><img src="https://i.imgur.com/ZcqMkOX.png" alt="" /></p>
<h3><a class="header" href="#5-run-your-node-with-metrics-enabled" id="5-run-your-node-with-metrics-enabled">5. Run your node with metrics enabled</a></h3>
<p>From your <code>nimbus-eth2</code> repository, run:</p>
<pre><code>make NIMFLAGS=&quot;-d:insecure&quot; medalla
</code></pre>
<h3><a class="header" href="#6-run-eth2stats" id="6-run-eth2stats">6. Run eth2stats</a></h3>
<p>From your <code>eth2stats-client</code> repository, <strong>run the command you copied in step 4.3:</strong></p>
<pre><code>./eth2stats-client run --eth2stats.node-name=&quot;roger&quot; --data.folder ~/.eth2stats/data --eth2stats.addr=&quot;grpc.medalla.eth2stats.io:443&quot; --eth2stats.tls=true --beacon.type=&quot;nimbus&quot; --beacon.addr=&quot;http://localhost:9190&quot; --beacon.metrics-addr=&quot;http://localhost:8008/metrics&quot;
</code></pre>
<p>Your node should now be displayed on eth2stats.io :)</p>
<h1><a class="header" href="#validating-with-a-raspberry-pi" id="validating-with-a-raspberry-pi">Validating with a Raspberry Pi</a></h1>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">I expect the new Raspberry Pi 4 (4GB RAM option, external SSD) to handle an Eth2 validator node without breaking a sweat. That&#39;s $100 of hardware running at 10 Watts to support a 32 ETH node (currently ~$10K stake).</p>&mdash; Justin √êrake (@drakefjustin) <a href="https://twitter.com/drakefjustin/status/1143091047058366465?ref_src=twsrc%5Etfw">June 24, 2019</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<h2><a class="header" href="#introduction-1" id="introduction-1">Introduction</a></h2>
<p>This page will take you through how to use your laptop to program your Raspberry Pi, get Nimbus running, and connect to the <strong>Medalla testnet</strong> (if this is not something you plan on doing, feel free to <a href="./keep-an-eye.html">skip ahead</a>).</p>
<p>One of the most important aspects of the Raspberry Pi experience is trying to make it as easy as possible to get started. As such, we try our best to explain things from first-principles.</p>
<h2><a class="header" href="#prerequisites-2" id="prerequisites-2">Prerequisites</a></h2>
<ul>
<li>Raspberry Pi 4 (4GB RAM option)</li>
<li>64GB microSD Card</li>
<li>microSD USB adapter</li>
<li>5V 3A USB-C charger</li>
<li>Reliable Wifi connection</li>
<li>Laptop</li>
<li>Basic understanding of the <a href="https://www.learnenough.com/command-line-tutorial/basics">command line</a></li>
</ul>
<h3><a class="header" href="#1-download-raspberry-pi-imager" id="1-download-raspberry-pi-imager">1. Download Raspberry Pi Imager</a></h3>
<p><a href="https://www.raspberrypi.org/blog/raspberry-pi-imager-imaging-utility/">Raspberry Pi Imager</a> is a new imaging utility that makes it simple to manage your microSD card with Raspbian (the free Pi operating system based on Debian).</p>
<p>You can find the <a href="https://www.learnenough.com/command-line-tutorial/basics">download</a> link for your operating system here: <a href="https://downloads.raspberrypi.org/imager/imager_1.4.exe">Windows</a>, <a href="https://downloads.raspberrypi.org/imager/imager_1.4.dmg">macOS</a>, <a href="https://downloads.raspberrypi.org/imager/imager_1.4_amd64.deb">Ubuntu</a>.</p>
<h3><a class="header" href="#2-plug-in-sd-card" id="2-plug-in-sd-card">2. Plug in SD card</a></h3>
<p>Use your microSD to USB adapter to plug the SD card into your computer.</p>
<h3><a class="header" href="#3-download-raspberry-pi-os" id="3-download-raspberry-pi-os">3. Download Raspberry Pi OS</a></h3>
<p>Open Raspberry Pi Imager and click on <strong>CHOOSE OS</strong></p>
<p><img src="https://storage.googleapis.com/ethereum-hackmd/upload_7b8cfa54f877218b6d971f09fa8d62ff.png" alt="" /></p>
<p>Select <strong>Raspberry Pi OS (other)</strong></p>
<p><img src="https://storage.googleapis.com/ethereum-hackmd/upload_543445a689fac6407a573da9fde9d224.png" alt="" /></p>
<p>Select <strong>Raspberry Pi OS Lite (32-bit)</strong></p>
<p><img src="https://storage.googleapis.com/ethereum-hackmd/upload_1a3cb9c5b4d7dedc8f31a9c4bf56d175.png" alt="" /></p>
<h3><a class="header" href="#4-write-to-sd-card" id="4-write-to-sd-card">4. Write to SD card</a></h3>
<p>Click on <strong>CHOOSE SD CARD</strong></p>
<p><img src="https://storage.googleapis.com/ethereum-hackmd/upload_99a150d6055c2139b3c468d405e5c731.png" alt="" /></p>
<p>You should see a menu pop-up with your SD card listed -- Select it</p>
<p><img src="https://storage.googleapis.com/ethereum-hackmd/upload_f90713c1ef782a94b5fce9eb8249c206.png" alt="" /></p>
<p>Click on <strong>WRITE</strong></p>
<p><img src="https://storage.googleapis.com/ethereum-hackmd/upload_0e02be31057745c6b9834a925c54b9d3.png" alt="" /></p>
<p>Click <strong>YES</strong></p>
<p><img src="https://storage.googleapis.com/ethereum-hackmd/upload_160208a5bc983165c2a1eb9bffed01c2.png" alt="" /></p>
<p>Make a cup of coffee :)</p>
<h3><a class="header" href="#5-set-up-wireless-lan" id="5-set-up-wireless-lan">5. Set up wireless LAN</a></h3>
<p>Since you have loaded Raspberry Pi OS onto a blank SD card, you will have two partitions. The first one, which is the smaller one, is the <code>boot</code> partition. </p>
<p>Create a <code>wpa_supplicant</code> configuration file in the <code>boot</code> partition with the following content:</p>
<pre><code># wpa_supplicant.conf

ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country=&lt;Insert 2 letter ISO 3166-1 country code here&gt;

network={
    ssid=&quot;&lt;Insert your Wifi network's name here&gt;&quot;
    psk=&quot;&lt;Insert your Wifi network's password here&gt;&quot;
}
</code></pre>
<blockquote>
<p><strong>Note:</strong> Don't forget to replace the placeholder <code>country</code>, <code>ssid</code>, and <code>psk</code> values. See <a href="https://en.wikipedia.org/wiki/ISO_3166-1">Wikipedia</a> for a list of 2 letter <code>ISO 3166-1</code> country codes.</p>
</blockquote>
<h3><a class="header" href="#6-enable-ssh-using-linux-or-macos" id="6-enable-ssh-using-linux-or-macos">6. Enable SSH (using Linux or macOS)</a></h3>
<p>You can <a href="https://www.raspberrypi.org/documentation/remote-access/ssh/">access the command line</a> of a Raspberry Pi remotely from another computer or device on the same network using <a href="https://en.wikipedia.org/wiki/Ssh_(Secure_Shell)">SSH</a>.</p>
<p>While SSH is not enabled by default, you can enable it by placing a file named <code>ssh</code>, without any extension, onto the boot partition of the SD card. </p>
<p>When the Pi boots, it will look for the <code>ssh</code> file. If it is found, SSH is enabled and the file is deleted. The content of the file does not matter; it can contain text, or nothing at all.</p>
<p>To create an empty <code>ssh</code> file, from the home directory of the <code>boot</code> partition file, run:</p>
<pre><code>touch ssh
</code></pre>
<h3><a class="header" href="#7-find-your-pis-ip-address" id="7-find-your-pis-ip-address">7. Find your Pi's IP address</a></h3>
<p>Since Raspberry Pi OS supports <a href="https://en.wikipedia.org/wiki/Multicast_DNS">Multicast_DNS</a> out of the box, you can reach your Raspberry Pi by using its hostname and the <code>.local</code> suffix.</p>
<p>The default hostname on a fresh Raspberry Pi OS install is <code>raspberrypi</code>, so any Raspberry Pi running Raspberry Pi OS should respond to:</p>
<pre><code>ping raspberrypi.local
</code></pre>
<p>The output should look more or less as follows:</p>
<pre><code>PING raspberrypi.local (195.177.101.93): 56 data bytes
64 bytes from 195.177.101.93: icmp_seq=0 ttl=64 time=13.272 ms
64 bytes from 195.177.101.93: icmp_seq=1 ttl=64 time=16.773 ms
64 bytes from 195.177.101.93: icmp_seq=2 ttl=64 time=10.828 ms
...
</code></pre>
<p>Keep note of your Pi's IP address. In the above case, that's <code>195.177.101.93</code></p>
<h3><a class="header" href="#8-ssh-using-linux-or-macos" id="8-ssh-using-linux-or-macos">8. SSH (using Linux or macOS)</a></h3>
<p>Connect to your Pi by running:</p>
<pre><code>ssh pi@195.177.101.93
</code></pre>
<p>You'll be prompted to enter a password:</p>
<pre><code>pi@195.177.101.93's password:
</code></pre>
<p>Enter the Pi's default password: <code>raspberry</code></p>
<p>You should see a message that looks like the following:</p>
<pre><code>Linux raspberrypi 5.4.51-v7l+ #1333 SMP Mon Aug 10 16:51:40 BST 2020 armv7l

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.

SSH is enabled and the default password for the 'pi' user has not been changed.
This is a security risk - please login as the 'pi' user and type 'passwd' to set a new password.
</code></pre>
<p>Followed by a command-line prompt indicating a successful connection:</p>
<pre><code>pi@raspberrypi:~ $ 
</code></pre>
<h3><a class="header" href="#9-increase-swap-size-to-2gb" id="9-increase-swap-size-to-2gb">9. Increase swap size to 2GB</a></h3>
<p>The first step is to increase the <a href="https://itsfoss.com/swap-size/">swap size</a> to 2GB (2048MB). </p>
<blockquote>
<p><strong>Note:</strong> Swap acts as a breather to your system when the RAM is exhausted. When the RAM is exhausted, your Linux system uses part of the hard disk memory and allocates it to the running application.</p>
</blockquote>
<p>Use the Pi's built-in text editor <a href="https://www.nano-editor.org/dist/latest/cheatsheet.html">nano</a> to open up the swap file:</p>
<pre><code>sudo nano /etc/dphys-swapfile
</code></pre>
<p>Change the value assigned to <code>CONF_SWAPSIZE</code> from <code>100</code> to <code>2048</code>:</p>
<pre><code>...

# set size to absolute value, leaving empty (default) then uses computed value
#   you most likely don't want this, unless you have an special disk situation
CONF_SWAPSIZE=2048

...

</code></pre>
<p>Save (<code>Ctrl+S</code>) and exit (<code>Ctrl+X</code>).</p>
<h3><a class="header" href="#10-reboot" id="10-reboot">10. Reboot</a></h3>
<p>Reboot your Pi to have the above changes take effect:</p>
<pre><code>sudo reboot
</code></pre>
<p>This will cause your connection to close. So you'll need to <code>ssh</code> into your Pi again:</p>
<pre><code>ssh pi@195.177.101.93
</code></pre>
<blockquote>
<p><strong>Note:</strong> Remember to replace <code>195.177.101.93</code> with the IP address of your Pi.</p>
</blockquote>
<h3><a class="header" href="#11-install-nimbus-dependencies" id="11-install-nimbus-dependencies">11. Install Nimbus dependencies</a></h3>
<p>You'll need to install some packages (<code>git</code>, <code>libgflags-dev</code>, <code>libsnappy-dev</code>, and <code>libpcre3-dev</code>) in order for Nimbus to run correctly.</p>
<p>To do so, run:</p>
<pre><code>sudo apt-get install git libgflags-dev libsnappy-dev libpcre3-dev

</code></pre>
<h3><a class="header" href="#12-install-screen" id="12-install-screen">12. Install Screen</a></h3>
<p><code>screen</code> is a tool that lets you safely detach from the SSH session without exiting the remote job. In other words <code>screen</code> allows the commands you run on your Pi from your laptop to keep running after you've logged out.</p>
<p>Run the following command to install <code>screen</code>:</p>
<pre><code>sudo apt-get install screen
</code></pre>
<h3><a class="header" href="#13-clone-the-nimbus-repository" id="13-clone-the-nimbus-repository">13. Clone the Nimbus repository</a></h3>
<p>Run the following command to clone the <a href="https://github.com/status-im/nimbus-eth2">nimbus-eth2 repository</a>:</p>
<pre><code>git clone https://github.com/status-im/nimbus-eth2
</code></pre>
<h3><a class="header" href="#14-build-the-beacon-node" id="14-build-the-beacon-node">14. Build the beacon node</a></h3>
<p>Change into the directory and build the beacon node.</p>
<pre><code>cd nimbus-eth2
make beacon_node
</code></pre>
<p><em>Patience... this may take a few minutes.</em></p>
<h3><a class="header" href="#15-copy-signing-key-over-to-pi" id="15-copy-signing-key-over-to-pi">15. Copy signing key over to Pi</a></h3>
<blockquote>
<p><strong>Note:</strong> If you haven't generated your validator key(s) and/or made your deposit yet, follow the instructions on <a href="./deposit.html">this page</a> before carrying on.</p>
</blockquote>
<p>We'll use the <code>scp</code> command to send files over SSH. It allows you to copy files between computers, say from your Raspberry Pi to your desktop/laptop, or vice-versa.</p>
<p>Copy the folder containing your validator key(s) from your computer to your <code>pi</code>'s homefolder by opening up a new terminal window and running the following command:</p>
<pre><code>scp -r &lt;VALIDATOR_KEYS_DIRECTORY&gt; pi@195.177.101.93:
</code></pre>
<blockquote>
<p><strong>Note:</strong> Don't forget the colon (:) at the end of the command!</p>
</blockquote>
<p>As usual, replace <code>195.177.101.93</code> with your Pi's IP address, and <code>&lt;VALIDATOR_KEYS_DIRECTORY&gt;</code> with the full pathname of your <code>validator_keys</code> directory (if you used the Launchpad <a href="https://github.com/ethereum/eth2.0-deposit-cli/releases/">command line app</a> this would have been created for you when you generated your keys).</p>
<blockquote>
<p><strong>Tip:</strong> run <code>pwd</code> in your <code>validator_keys</code> directory to print the full pathname to the console.</p>
</blockquote>
<h3><a class="header" href="#16-import-signing-key-into-nimbus" id="16-import-signing-key-into-nimbus">16. Import signing key into Nimbus</a></h3>
<p>To import your signing key into Nimbus, from the <code>nimbus-eth2</code> directory run:</p>
<pre><code>build/beacon_node deposits import  --data-dir=build/data/shared_medalla_0 ../validator_keys 
</code></pre>
<p>You'll be asked to enter the password you created to encrypt your keystore(s). Don't worry, this is entirely normal. Your validator client needs both your signing keystore(s) and the password encrypting it to import your <a href="https://blog.ethereum.org/2020/05/21/keys/">key</a> (since it needs to decrypt the keystore in order to be able to use it to sign on your behalf).</p>
<h3><a class="header" href="#17-run-screen" id="17-run-screen">17. Run Screen</a></h3>
<p>From the <code>nimbus-eth2</code> directory, run: </p>
<pre><code>screen
</code></pre>
<p>You should see output that looks like the following: </p>
<pre><code>GNU Screen version 4.06.02 (GNU) 23-Oct-17

Copyright (c) 2015-2017 Juergen Weigert, Alexander Naumov, Amadeusz Slawinski
Copyright (c) 2010-2014 Juergen Weigert, Sadrul Habib Chowdhury
Copyright (c) 2008-2009 Juergen Weigert, Michael Schroeder, Micah Cowan, Sadrul Habib Chowdhury
Copyright (c) 1993-2007 Juergen Weigert, Michael Schroeder
Copyright (c) 1987 Oliver Laumann

This program is free software; you can redistribute it and/or modify it under the terms of the GNU
General Public License as published by the Free Software Foundation; either version 3, or (at your
option) any later version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even
the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public
License for more details.

You should have received a copy of the GNU General Public License along with this program (see the file
COPYING); if not, see http://www.gnu.org/licenses/, or contact Free Software Foundation, Inc., 51
Franklin Street, Fifth Floor, Boston, MA  02111-1301  USA.

Send bugreports, fixes, enhancements, t-shirts, money, beer &amp; pizza to screen-devel@gnu.org


Capabilities:
+copy +remote-detach +power-detach +multi-attach +multi-user +font +color-256 +utf8 +rxvt
+builtin-telnet
</code></pre>
<p>Press <code>Enter</code> or <code>Space</code>.</p>
<h3><a class="header" href="#18-connect-to-medalla" id="18-connect-to-medalla">18. Connect to medalla</a></h3>
<p>We're finally ready to connect to medalla!</p>
<blockquote>
<p><strong>Note:</strong> If you haven't already, we recommend registering for, and running, your own Infura endpoint to connect to eth1. For instruction on how to do so, see <a href="./infura-guide.html">this page</a>.</p>
</blockquote>
<p>To connect to medalla, run:</p>
<pre><code>make NODE_PARAMS=&quot;--web3-url=wss://goerli.infura.io/ws/v3/ae1e57122a1e49af8e835e82a5e35e60&quot; medalla
</code></pre>
<p>Be sure to replace the <code>web3-url</code> above with your own websocket (<code>wss</code>) Infura endpoint.<sup class="footnote-reference"><a href="#1">1</a></sup></p>
<h3><a class="header" href="#19-check-for-successful-connection" id="19-check-for-successful-connection">19. Check for successful connection</a></h3>
<p>If you look near the top of the logs printed to your console, you should see confirmation that your beacon node has started, with your local validator attached:</p>
<pre><code>INF 2020-10-07 17:04:09.213+02:00 Initializing networking                    topics=&quot;networking&quot; tid=11688398 file=eth2_network.nim:1335 hostAddress=/ip4/0.0.0.0/tcp/9000 network_public_key=0802122102defb020c8e47dd8f5da89f51ed6c3998aaa0dd59eeb2784e29d47fdbdab69235 announcedAddresses=@[/ip4/195.177.101.93/tcp/9000]
WRN 2020-10-07 17:04:09.215+02:00 Ignoring invalid bootstrap address         tid=11688398 file=eth2_discovery.nim:45 bootstrapAddr= reason=&quot;an empty string is not a valid bootstrap node&quot;
NOT 2020-10-07 17:04:09.231+02:00 Local validators attached                  topics=&quot;beacval&quot; tid=11688398 file=validator_duties.nim:65 count=0
NOT 2020-10-07 17:04:09.231+02:00 Starting beacon node                       topics=&quot;beacnde&quot; tid=11688398 file=beacon_node.nim:923 version=&quot;0.5.0 (1dec860b)&quot; nim=&quot;Nim Compiler Version 1.2.6 [MacOSX: amd64] (bf320ed1)&quot; timeSinceFinalization=0ns head=0814b036:0 finalizedHead=0814b036:0 SLOTS_PER_EPOCH=32 SECONDS_PER_SLOT=12 SPEC_VERSION=0.12.3 dataDir=build/data/shared_zinken_0
</code></pre>
<p>To keep track of your syncing progress, have a look at the output at the very bottom of the terminal window in which your validator is running. You should see something like:</p>
<pre><code>peers: 35 ‚ùØ finalized: ada7228a:8765 ‚ùØ head: b2fe11cd:8767:2 ‚ùØ time: 9900:7 (316807) ‚ùØ sync: wPwwwwwDwwDPwPPPwwww:7:4.0627 (280512)
</code></pre>
<p>Keep an eye on the number of peers your currently connected to (in the above case that's <code>35</code>), as well as your <a href="./keep-an-eye.html#syncing-progress">sync progress</a>.</p>
<h3><a class="header" href="#20-end-ssh-session-and-logout" id="20-end-ssh-session-and-logout">20. End ssh session and logout</a></h3>
<p>To detach your <code>screen</code> session but leave your processes running, press <code>Ctrl-A</code> followed by <code>Ctrl-D</code>. You can now exit your <code>ssh</code> session (<code>Ctrl-C</code>) and switch off your laptop.</p>
<p>Verifying your progress is as simple as <code>ssh</code>ing back into your Pi and typing <code>screen -r</code>. This will resume your screen session (and you will be able to see your node's entire output since you logged out).</p>
<hr />
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>If you were to just run <code>make medalla</code>, the beacon node would launch with an Infura endpoint supplied by us. This endpoint is passed through the <code>web3-url</code> option (which takes as input the url of the web3 server from which you'd like to observe the eth1 chain). Because Infura caps the requests per endpoint per day to 100k, and all Nimbus nodes use the same Infura endpoint by default, it can happen that our Infura endpoint is overloaded (i.e the requests on a given day reach the 100k limit). If this happens, all requests to Infura using the default endpoint will fail, which means your node will stop processing new deposits.
To pass in your own Infura endpoint, you'll need to run:
<code> make NODE_PARAMS=&quot;--web3-url=&lt;YOUR_WEBSOCKET_ENDPOINT&gt;&quot; medalla </code>
Importantly, the endpoint must be a websocket (<code>wss</code>) endpoint, not <code>https</code>. If you're not familiar with Infura, we recommend reading through our <a href="./infura-guide">Infura guide</a>, first. <strong>P.S.</strong> We are well aware that Infura is less than ideal from a decentralisation perspective. As such we are in the process of changing our default to <a href="https://geth.ethereum.org/docs/install-and-build/installing-geth">Geth</a> (with Infura as a fallback). For some rough notes on how to use Geth with Nimbus, see <a href="https://gist.github.com/onqtam/aaf883d46f4dab1311ca9c160df12fe4">here</a> (we will be adding more complete instructions very soon).</p>
</div>
<h1><a class="header" href="#graffiti" id="graffiti">Graffiti</a></h1>
<p><em>Todo</em></p>
<pre><code>make NODE_PARAMS=&quot;--graffiti='&lt;YOUR_GRAFFITI&gt;'&quot; medalla
</code></pre>
<h1><a class="header" href="#supplying-your-own-infura-endpoint" id="supplying-your-own-infura-endpoint">Supplying your own Infura endpoint</a></h1>
<blockquote>
<p>‚ö†Ô∏è  This page concerns the Medalla testnet. If you have made a mainnet deposit, you do not need to connect to eth2 quite yet. Mainnet <a href="https://hackmd.io/@benjaminion/genesis">Genesis</a> date has been set to <a href="https://blog.ethereum.org/2020/11/04/eth2-quick-update-no-19/">December 1st</a>. This page will be updated nearer the time.</p>
</blockquote>
<p>In a nutshell, Infura is a hosted ethereum node cluster that lets you make requests to the eth1 blockchain without requiring you to set up your own eth1 node.</p>
<p>While we do support Infura to process incoming validator deposits, we recommend running your own eth1 node to avoid relying on a third-party-service.</p>
<blockquote>
<p><strong>Note:</strong> Nimbus currently supports remote Infura nodes and <a href="https://gist.github.com/onqtam/aaf883d46f4dab1311ca9c160df12fe4">local Geth archive nodes</a>. However we are working on relaxing that assumption (an archive node certainly won't be required for mainnet). In the future, we plan on having our own eth1 client -- <a href="https://github.com/status-im/nimbus">Nimbus 1</a> -- be the recommended default.</p>
</blockquote>
<h2><a class="header" href="#how-it-works" id="how-it-works">How it works</a></h2>
<p>When you join an eth2 testnet by running <code>make zinken</code> or <code>make medalla</code>, the beacon node actually launches with an Infura endpoint supplied by us. </p>
<p>This endpoint is passed through the <code>web3-url</code> option (which takes as input the url of the web3 server from which you'd like to observe the eth1 chain).</p>
<p>If you look at the initial logs you should see something similar to the following:</p>
<pre><code>DBG 2020-09-29 12:15:41.969+02:00 Launching beacon node
topics=&quot;beacnde&quot; tid=8941404 file=beacon_node.nim:1190 version=&quot;0.5.0 (78ceeed8)&quot; bls_backend=BLST 
cmdParams=&quot;@[
\&quot;--network=zinken\&quot;,
\&quot;--log-level=DEBUG\&quot;,
\&quot;--log-file=build/data/shared_zinken_0/nbc_bn_20200929121541.log\&quot;,
\&quot;--data-dir=build/data/shared_zinken_0\&quot;,
\&quot;--web3-url=wss://goerli.infura.io/ws/v3/809a18497dd74102b5f37d25aae3c85a\&quot;,
\&quot;--tcp-port=9000\&quot;,
\&quot;--udp-port=9000\&quot;,
\&quot;--metrics\&quot;,
\&quot;--metrics-port=8008\&quot;,
\&quot;--rpc\&quot;,
\&quot;--rpc-port=9190\&quot;
]&quot;
...
</code></pre>
<p>This allows us to deduce that the default endpoint is given by: </p>
<pre><code>--web3-url=wss://goerli.infura.io/ws/v3/809a18497dd74102b5f37d25aae3c85a\&quot;
</code></pre>
<h2><a class="header" href="#potential-problems" id="potential-problems">Potential problems</a></h2>
<p>Because Infura caps the requests per endpoint per day to 100k, and all Nimbus nodes use the same Infura endpoint by default, it can happen that our Infura endpoint is overloaded (i.e the requests on a given day reach the 100k limit). If this happens, all requests to Infura using the default endpoint will fail, which means your node will stop processing new deposits.</p>
<p>To know if our endpoint has reached its limit for the day, keep your eye out for error messages that look like the following:</p>
<pre><code>ERR 2020-09-29 14:04:33.313+02:00 Mainchain monitor failure, restarting      tid=8941404 
file=eth1_monitor.nim:812 err=&quot;{\&quot;code\&quot;:-32005,
\&quot;data\&quot;:{\&quot;rate\&quot;:{\&quot;allowed_rps\&quot;:1,
\&quot;backoff_seconds\&quot;:24,
\&quot;current_rps\&quot;:22.5},
\&quot;see\&quot;:\&quot;https://infura.io/dashboard\&quot;},
\&quot;message\&quot;:\&quot;daily request count exceeded, request rate limited\&quot;}&quot;
</code></pre>
<p>To get around this problem, we recommend launching the beacon node with your own endpoint.</p>
<h2><a class="header" href="#supplying-your-own-endpoint" id="supplying-your-own-endpoint">Supplying your own endpoint</a></h2>
<blockquote>
<p><strong>Note:</strong> In a previous version of the software it wasn't possible to manually override the web3 endpoint when running <code>make zinken</code> or <code>make medalla</code>. For the instructions below to work, make sure you've updated to the latest version of the software (run <code>git pull &amp;&amp; make update</code> from the <code>master</code> branch of the <code>nimbus-eth2</code> repository).</p>
</blockquote>
<h3><a class="header" href="#1-visit-infuraio" id="1-visit-infuraio">1. Visit Infura.io</a></h3>
<p>Go to:</p>
<p><a href="https://infura.io/">https://infura.io/</a> </p>
<p>and click on <code>Get Started For Free</code></p>
<p><img src="https://i.imgur.com/BtStgup.png" alt="" /></p>
<h3><a class="header" href="#2-sign-up" id="2-sign-up">2. Sign up</a></h3>
<p>Enter your email address and create a password</p>
<p><img src="https://i.imgur.com/al1OsdR.png" alt="" /></p>
<h3><a class="header" href="#3-verify-email-address" id="3-verify-email-address">3. Verify email address</a></h3>
<p>You should have received an email from Infura in your inbox. Open up it up and click on <code>Confirm Email Address</code></p>
<p><img src="https://i.imgur.com/EAD8ZhV.png" alt="" /></p>
<h3><a class="header" href="#4-go-to-dashboard" id="4-go-to-dashboard">4. Go to dashboard</a></h3>
<p>This will take you to your Infura dashboard (https://infura.io/dashboard/)</p>
<p><img src="https://i.imgur.com/LuNcoYr.png" alt="" /></p>
<h3><a class="header" href="#5-create-your-first-project" id="5-create-your-first-project">5. Create your first project</a></h3>
<p>Click on the first option (<code>create your first project</code>) under <code>Let's Get Started</code></p>
<p><img src="https://i.imgur.com/wBAGhcs.png" alt="" /></p>
<p>Choose a name for your project</p>
<p><img src="https://i.imgur.com/yr5vnSo.png" alt="" /></p>
<p>You'll be directed to the settings page of your newly created project</p>
<p><img src="https://i.imgur.com/kx3R8XS.png" alt="" /></p>
<h3><a class="header" href="#6-view-g√∂rli-endpoints" id="6-view-g√∂rli-endpoints">6. View G√∂rli endpoints</a></h3>
<p>In the <code>KEYS</code> section, click on the dropdown menu to the right of <code>ENDPOINTS</code>, and select <code>G√ñRLI</code></p>
<p><img src="https://i.imgur.com/D9186kv.png" alt="" /></p>
<h3><a class="header" href="#7-copy-the-websocket-endpoint" id="7-copy-the-websocket-endpoint">7. Copy the websocket endpoint</a></h3>
<p>Copy the address that starts with <code>wss://</code></p>
<p><img src="https://i.imgur.com/fZ6Bcjy.png" alt="" /></p>
<blockquote>
<p>‚ö†Ô∏è <strong>Warning:</strong> make sure you've copied the endpoint that starts with<code>wss</code> (websocket), and not the <code>https</code> endpoint.</p>
</blockquote>
<h3><a class="header" href="#8-run-the-beacon-node" id="8-run-the-beacon-node">8. Run the beacon node</a></h3>
<p>Run the beacon node on your favourite testnet, pasting in your websocket endpoint as the input to the <code>web3-url</code> option.</p>
<pre><code>make NODE_PARAMS=&quot;--web3-url=wss://goerli.infura.io/ws/v3/83b9d67f81ca401b8f9651441b43f29e&quot;
&lt;TESTNET_NAME&gt;
</code></pre>
<blockquote>
<p>Remember to replace &lt;TESTNET_NAME&gt; with either <code>medalla</code> or <code>zinken</code>.</p>
</blockquote>
<h3><a class="header" href="#9-check-stats" id="9-check-stats">9. Check stats</a></h3>
<p>Visit your project's stats page to see a summary of your eth1 related activity and method calls </p>
<p><img src="https://i.imgur.com/MZVTHHV.png" alt="" /></p>
<p>That's all there is to it :)</p>
<h1><a class="header" href="#advanced-options" id="advanced-options">Advanced options</a></h1>
<h3><a class="header" href="#start-multiple-nodes" id="start-multiple-nodes">Start multiple nodes</a></h3>
<p>You can start multiple local nodes, in different terminal windows/tabs, by specifying numeric IDs:</p>
<pre><code>make medalla NODE_ID=0 # the default
make medalla NODE_ID=1
make medalla NODE_ID=2
</code></pre>
<h3><a class="header" href="#attach-multiple-validators-to-the-same-beacon-node" id="attach-multiple-validators-to-the-same-beacon-node">Attach multiple validators to the same beacon node</a></h3>
<p>Simply <a href="./medalla.html#3-import-keystores">import as many keystores as you wish</a> before running <code>make medalla</code>. Nimbus will automagically find your keys and attach your validators. See <a href="./medalla.html#key-management">key management</a> for more information on where we store your keys.</p>
<p>To give you some context, we (the Nimbus team) are currently running 170 validators per beacon node on our AWS instances.</p>
<h3><a class="header" href="#change-the-tcp-and-udp-ports" id="change-the-tcp-and-udp-ports">Change the TCP and UDP ports</a></h3>
<p>To change the TCP and UDP ports from their default value of 9000 to 9100, say, run:</p>
<pre><code>make BASE_PORT=9100 medalla
</code></pre>
<p>You may need to do this if you are running another client.</p>
<h3><a class="header" href="#node-parameters" id="node-parameters">Node parameters</a></h3>
<p>You can customise your beacon node's parameters using the <code>NODE_PARAMS</code> option:</p>
<pre><code>make NODE_PARAMS=&quot;--tcp-port=9100 --udp-port=9100&quot; medalla
</code></pre>
<blockquote>
<p><strong>Note:</strong> the above command has exactly the same effect as <code>make BASE_PORT=9100 medalla</code></p>
</blockquote>
<p>A complete list of the available parameters can be found <a href="https://github.com/status-im/nimbus-eth2/blob/devel/beacon_chain/conf.nim#L92-L210">here</a> (use a parameter's <code>name</code> field to set it).</p>
<h3><a class="header" href="#logs" id="logs">Logs</a></h3>
<p>Log files are saved in <code>build/data/shared_medalla_0/</code>.</p>
<h3><a class="header" href="#makefile" id="makefile">Makefile</a></h3>
<p>If you are comfortable reading <a href="https://en.wikipedia.org/wiki/Makefile#:%7E:text=A%20makefile%20is%20a%20file,to%20generate%20a%20target%2Fgoal">Makefiles</a>, you can see the commands that <code>make medalla</code>  executes under the hood, <a href="https://github.com/status-im/nimbus-eth2/blob/23bec993414df904e9d7ea9d26e65005b981aee0/Makefile#L184-L197">here</a>.</p>
<p>Some of the provided options (such as <code>--network=medalla</code>) are essential while others (such as the ones controlling logging, metrics, ports, and the RPC service) are there for convenience.</p>
<p>The Goerli testnet parameters (<code>$(GOERLI_TESTNETS_PARAMS</code>), are defined higher up in the Makefile, <a href="https://github.com/status-im/nimbus-eth2/blob/23bec993414df904e9d7ea9d26e65005b981aee0/Makefile#L164-L171">here</a>.</p>
<h3><a class="header" href="#make-a-deposit-directly-using-nimbus" id="make-a-deposit-directly-using-nimbus">Make a deposit directly using Nimbus</a></h3>
<pre><code>make medalla-deposit VALIDATORS=2 # default is just 1
</code></pre>
<h1><a class="header" href="#apis" id="apis">APIs</a></h1>
<p><code>nimbus-eth2</code>  exposes a collection of APIs for querying the state of the application at runtime.</p>
<blockquote>
<p><strong>Note:</strong> Where applicable, these APIs mimic the <a href="https://github.com/ethereum/eth2.0-APIs">eth2 APIs</a> with the exception that JSON-RPC is used instead of http rest (the method names, parameters and results are all the same except for the encoding / access method).</p>
</blockquote>
<h2><a class="header" href="#introduction-2" id="introduction-2">Introduction</a></h2>
<p>The <code>nimbus-eth2</code> API is implemented using JSON-RPC 2.0. To query it, you can use a JSON-RPC library in the language of your choice, or a tool like <code>curl</code> to access it from the command line. A tool like <a href="https://stedolan.github.io/jq/">jq</a> is helpful to pretty-print the responses.</p>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:&quot;id&quot;,&quot;method&quot;:&quot;peers&quot;,&quot;params&quot;:[] }' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<p>Before you can access the API, make sure it's enabled using the RPC flag (<code>beacon_node --rpc</code>):</p>
<pre><code>     --rpc                     Enable the JSON-RPC server.
     --rpc-port                HTTP port for the JSON-RPC service.
     --rpc-address             Listening address of the RPC server.
</code></pre>
<p>One difference is that currently endpoints that correspond to specific ones from the <a href="https://ethereum.github.io/eth2.0-APIs/">spec</a> are named weirdly - for example an endpoint such as <a href="https://ethereum.github.io/eth2.0-APIs/#/Beacon/getGenesis"><code>getGenesis</code></a> is currently named <code>get_v1_beacon_genesis</code> which would map 1:1 to the actual REST path in the future - verbose but unambiguous.</p>
<h2><a class="header" href="#beacon-node-api" id="beacon-node-api">Beacon Node API</a></h2>
<h3><a class="header" href="#getbeaconhead" id="getbeaconhead">getBeaconHead</a></h3>
<p>The latest head slot, as chosen by the latest fork choice.</p>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:&quot;id&quot;,&quot;method&quot;:&quot;getBeaconHead&quot;,&quot;params&quot;:[] }' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h3><a class="header" href="#getchainhead" id="getchainhead">getChainHead</a></h3>
<p>Show chain head information, including head, justified and finalized checkpoints.</p>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:&quot;id&quot;,&quot;method&quot;:&quot;getChainHead&quot;,&quot;params&quot;:[] }' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h3><a class="header" href="#getsyncing" id="getsyncing">getSyncing</a></h3>
<h3><a class="header" href="#getnetworkpeerid" id="getnetworkpeerid">getNetworkPeerId</a></h3>
<h3><a class="header" href="#getnetworkpeers" id="getnetworkpeers">getNetworkPeers</a></h3>
<h3><a class="header" href="#getnetworkenr" id="getnetworkenr">getNetworkEnr</a></h3>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:&quot;id&quot;,&quot;method&quot;:&quot;getNetworkEnr&quot;,&quot;params&quot;:[] }' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisbeacongetgenesisget_v1_beacon_genesisa" id="a-hrefhttpsethereumgithubioeth20-apisbeacongetgenesisget_v1_beacon_genesisa"><a href="https://ethereum.github.io/eth2.0-APIs/#/Beacon/getGenesis"><code>get_v1_beacon_genesis</code></a></a></h3>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;get_v1_beacon_genesis&quot;,&quot;params&quot;:[],&quot;id&quot;:1}' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisbeacongetstaterootget_v1_beacon_states_roota" id="a-hrefhttpsethereumgithubioeth20-apisbeacongetstaterootget_v1_beacon_states_roota"><a href="https://ethereum.github.io/eth2.0-APIs/#/Beacon/getStateRoot"><code>get_v1_beacon_states_root</code></a></a></h3>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;get_v1_beacon_states_root&quot;,&quot;params&quot;:[&quot;finalized&quot;],&quot;id&quot;:1}' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisbeacongetstateforkget_v1_beacon_states_forka" id="a-hrefhttpsethereumgithubioeth20-apisbeacongetstateforkget_v1_beacon_states_forka"><a href="https://ethereum.github.io/eth2.0-APIs/#/Beacon/getStateFork"><code>get_v1_beacon_states_fork</code></a></a></h3>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;get_v1_beacon_states_fork&quot;,&quot;params&quot;:[&quot;finalized&quot;],&quot;id&quot;:1}' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisbeacongetstatefinalitycheckpointsget_v1_beacon_states_finality_checkpointsa" id="a-hrefhttpsethereumgithubioeth20-apisbeacongetstatefinalitycheckpointsget_v1_beacon_states_finality_checkpointsa"><a href="https://ethereum.github.io/eth2.0-APIs/#/Beacon/getStateFinalityCheckpoints"><code>get_v1_beacon_states_finality_checkpoints</code></a></a></h3>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;get_v1_beacon_states_finality_checkpoints&quot;,&quot;params&quot;:[&quot;finalized&quot;],&quot;id&quot;:1}' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisbeacongetstatevalidatorsget_v1_beacon_states_stateid_validatorsa" id="a-hrefhttpsethereumgithubioeth20-apisbeacongetstatevalidatorsget_v1_beacon_states_stateid_validatorsa"><a href="https://ethereum.github.io/eth2.0-APIs/#/Beacon/getStateValidators"><code>get_v1_beacon_states_stateId_validators</code></a></a></h3>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisbeacongetstatevalidatorget_v1_beacon_states_stateid_validators_validatorida" id="a-hrefhttpsethereumgithubioeth20-apisbeacongetstatevalidatorget_v1_beacon_states_stateid_validators_validatorida"><a href="https://ethereum.github.io/eth2.0-APIs/#/Beacon/getStateValidator"><code>get_v1_beacon_states_stateId_validators_validatorId</code></a></a></h3>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisbeacongetepochcommitteesget_v1_beacon_states_stateid_committees_epocha" id="a-hrefhttpsethereumgithubioeth20-apisbeacongetepochcommitteesget_v1_beacon_states_stateid_committees_epocha"><a href="https://ethereum.github.io/eth2.0-APIs/#/Beacon/getEpochCommittees"><code>get_v1_beacon_states_stateId_committees_epoch</code></a></a></h3>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisbeacongetblockheadersget_v1_beacon_headersa" id="a-hrefhttpsethereumgithubioeth20-apisbeacongetblockheadersget_v1_beacon_headersa"><a href="https://ethereum.github.io/eth2.0-APIs/#/Beacon/getBlockHeaders"><code>get_v1_beacon_headers</code></a></a></h3>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisbeacongetblockheaderget_v1_beacon_headers_blockida" id="a-hrefhttpsethereumgithubioeth20-apisbeacongetblockheaderget_v1_beacon_headers_blockida"><a href="https://ethereum.github.io/eth2.0-APIs/#/Beacon/getBlockHeader"><code>get_v1_beacon_headers_blockId</code></a></a></h3>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;get_v1_beacon_headers_blockId&quot;,&quot;params&quot;:[&quot;finalized&quot;],&quot;id&quot;:1}' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisbeacongetblockget_v1_beacon_blocks_blockida" id="a-hrefhttpsethereumgithubioeth20-apisbeacongetblockget_v1_beacon_blocks_blockida"><a href="https://ethereum.github.io/eth2.0-APIs/#/Beacon/getBlock"><code>get_v1_beacon_blocks_blockId</code></a></a></h3>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;get_v1_beacon_blocks_blockId&quot;,&quot;params&quot;:[&quot;finalized&quot;],&quot;id&quot;:1}' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisbeacongetblockrootget_v1_beacon_blocks_blockid_roota" id="a-hrefhttpsethereumgithubioeth20-apisbeacongetblockrootget_v1_beacon_blocks_blockid_roota"><a href="https://ethereum.github.io/eth2.0-APIs/#/Beacon/getBlockRoot"><code>get_v1_beacon_blocks_blockId_root</code></a></a></h3>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;get_v1_beacon_blocks_blockId_root&quot;,&quot;params&quot;:[&quot;finalized&quot;],&quot;id&quot;:1}' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisbeacongetblockattestationsget_v1_beacon_blocks_blockid_attestationsa" id="a-hrefhttpsethereumgithubioeth20-apisbeacongetblockattestationsget_v1_beacon_blocks_blockid_attestationsa"><a href="https://ethereum.github.io/eth2.0-APIs/#/Beacon/getBlockAttestations"><code>get_v1_beacon_blocks_blockId_attestations</code></a></a></h3>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;get_v1_beacon_blocks_blockId_attestations&quot;,&quot;params&quot;:[&quot;finalized&quot;],&quot;id&quot;:1}' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisbeaconsubmitpoolattestationspost_v1_beacon_pool_attestationsa" id="a-hrefhttpsethereumgithubioeth20-apisbeaconsubmitpoolattestationspost_v1_beacon_pool_attestationsa"><a href="https://ethereum.github.io/eth2.0-APIs/#/Beacon/submitPoolAttestations"><code>post_v1_beacon_pool_attestations</code></a></a></h3>
<h2><a class="header" href="#valdiator-api" id="valdiator-api">Valdiator API</a></h2>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisvalidatorrequiredapiproduceblockget_v1_validator_blocka" id="a-hrefhttpsethereumgithubioeth20-apisvalidatorrequiredapiproduceblockget_v1_validator_blocka"><a href="https://ethereum.github.io/eth2.0-APIs/#/ValidatorRequiredApi/produceBlock"><code>get_v1_validator_block</code></a></a></h3>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisvalidatorrequiredapipublishblockpost_v1_validator_blocka" id="a-hrefhttpsethereumgithubioeth20-apisvalidatorrequiredapipublishblockpost_v1_validator_blocka"><a href="https://ethereum.github.io/eth2.0-APIs/#/ValidatorRequiredApi/publishBlock"><code>post_v1_validator_block</code></a></a></h3>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisvalidatorrequiredapiproduceattestationget_v1_validator_attestationa" id="a-hrefhttpsethereumgithubioeth20-apisvalidatorrequiredapiproduceattestationget_v1_validator_attestationa"><a href="https://ethereum.github.io/eth2.0-APIs/#/ValidatorRequiredApi/produceAttestation"><code>get_v1_validator_attestation</code></a></a></h3>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;get_v1_validator_attestation_data&quot;,&quot;params&quot;:[0,3],&quot;id&quot;:1}' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisvalidatorrequiredapigetaggregatedattestationget_v1_validator_aggregate_and_proofa" id="a-hrefhttpsethereumgithubioeth20-apisvalidatorrequiredapigetaggregatedattestationget_v1_validator_aggregate_and_proofa"><a href="https://ethereum.github.io/eth2.0-APIs/#/ValidatorRequiredApi/getAggregatedAttestation"><code>get_v1_validator_aggregate_and_proof</code></a></a></h3>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisvalidatorrequiredapipublishaggregateandproofpost_v1_validator_aggregate_and_proofa" id="a-hrefhttpsethereumgithubioeth20-apisvalidatorrequiredapipublishaggregateandproofpost_v1_validator_aggregate_and_proofa"><a href="https://ethereum.github.io/eth2.0-APIs/#/ValidatorRequiredApi/publishAggregateAndProof"><code>post_v1_validator_aggregate_and_proof</code></a></a></h3>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisvalidatorrequiredapigetattesterdutiespost_v1_validator_duties_attestera" id="a-hrefhttpsethereumgithubioeth20-apisvalidatorrequiredapigetattesterdutiespost_v1_validator_duties_attestera"><a href="https://ethereum.github.io/eth2.0-APIs/#/ValidatorRequiredApi/getAttesterDuties"><code>post_v1_validator_duties_attester</code></a></a></h3>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;post_v1_validator_duties_attester&quot;,&quot;params&quot;:[1,[&quot;a7a0502eae26043d1ac39a39457a6cdf68fae2055d89c7dc59092c25911e4ee55c4e7a31ade61c39480110a393be28e8&quot;,&quot;a1826dd94cd96c48a81102d316a2af4960d19ca0b574ae5695f2d39a88685a43997cef9a5c26ad911847674d20c46b75&quot;]],&quot;id&quot;:1}' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisvalidatorrequiredapigetproposerdutiesget_v1_validator_duties_proposera" id="a-hrefhttpsethereumgithubioeth20-apisvalidatorrequiredapigetproposerdutiesget_v1_validator_duties_proposera"><a href="https://ethereum.github.io/eth2.0-APIs/#/ValidatorRequiredApi/getProposerDuties"><code>get_v1_validator_duties_proposer</code></a></a></h3>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:&quot;id&quot;,&quot;method&quot;:&quot;get_v1_validator_duties_proposer&quot;,&quot;params&quot;:[1] }' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h2><a class="header" href="#config" id="config">Config</a></h2>
<h3><a class="header" href="#a-hrefhttpsethereumgithubioeth20-apisconfiggetforkscheduleget_v1_config_fork_schedulea" id="a-hrefhttpsethereumgithubioeth20-apisconfiggetforkscheduleget_v1_config_fork_schedulea"><a href="https://ethereum.github.io/eth2.0-APIs/#/Config/getForkSchedule"><code>get_v1_config_fork_schedule</code></a></a></h3>
<h2><a class="header" href="#administrative--debug-api" id="administrative--debug-api">Administrative / Debug API</a></h2>
<h3><a class="header" href="#get_v1_debug_beacon_states_stateid---returns-an-entire-beaconstate-object-for-the-specified-stateid" id="get_v1_debug_beacon_states_stateid---returns-an-entire-beaconstate-object-for-the-specified-stateid"><code>get_v1_debug_beacon_states_stateId</code> - returns an entire <code>BeaconState</code> object for the specified <code>stateId</code></a></h3>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;get_v1_debug_beacon_states_stateId&quot;,&quot;params&quot;:[&quot;head&quot;],&quot;id&quot;:1}' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h3><a class="header" href="#getnodeversion" id="getnodeversion">getNodeVersion</a></h3>
<p>Show version of the software</p>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:&quot;id&quot;,&quot;method&quot;:&quot;getNodeVersion&quot;,&quot;params&quot;:[] }' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h3><a class="header" href="#getspecpreset" id="getspecpreset">getSpecPreset</a></h3>
<p>Show spec constants in use.</p>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:&quot;id&quot;,&quot;method&quot;:&quot;getSpecPreset&quot;,&quot;params&quot;:[] }' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h3><a class="header" href="#peers" id="peers">peers</a></h3>
<p>Show a list of peers that the beacon node is connected to.</p>
<pre><code>curl -d '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:&quot;id&quot;,&quot;method&quot;:&quot;peers&quot;,&quot;params&quot;:[] }' -H 'Content-Type: application/json' localhost:9190 -s | jq
</code></pre>
<h1><a class="header" href="#for-developers" id="for-developers">For Developers</a></h1>
<p>Latest updates happen in the <code>devel</code> branch which is merged into <code>master</code> every week on Tuesday.</p>
<p>This page contains tips and tricks for developers, further resources, along with information on how to set up your build environment on your platform.</p>
<h3><a class="header" href="#ubuntu-guide" id="ubuntu-guide">Ubuntu guide</a></h3>
<p>See <a href="https://medium.com/@SomerEsat/guide-to-staking-on-ethereum-2-0-ubuntu-medalla-nimbus-5f4b2b0f2d7c">this excellent resource</a> for detailed step-by-step guide on how to stake on eth2 with Ubuntu.</p>
<p>It contains instructions on how to:</p>
<ul>
<li>Configure a newly running Ubuntu server instance</li>
<li>Configure and run an eth1 node as a service</li>
<li>Compile and configure the Nimbus client for eth 2, phase 0 (Medalla testnet)</li>
<li>Install and configure <a href="https://prometheus.io/">Prometheus</a> metrics and set up a <a href="https://grafana.com/">Grafana</a> dashboard</li>
</ul>
<h3><a class="header" href="#windows-dev-environment" id="windows-dev-environment">Windows dev environment</a></h3>
<p>Install Mingw-w64 for your architecture using the &quot;<a href="https://sourceforge.net/projects/mingw-w64/files/">MinGW-W64 Online
Installer</a>&quot; (first link
under the directory listing). Run it and select your architecture in the setup
menu (<code>i686</code> on 32-bit, <code>x86_64</code> on 64-bit), set the threads to <code>win32</code> and
the exceptions to &quot;dwarf&quot; on 32-bit and &quot;seh&quot; on 64-bit. Change the
installation directory to &quot;C:\mingw-w64&quot; and add it to your system PATH in &quot;My
Computer&quot;/&quot;This PC&quot; -&gt; Properties -&gt; Advanced system settings -&gt; Environment
Variables -&gt; Path -&gt; Edit -&gt; New -&gt; C:\mingw-w64\mingw64\bin (it's &quot;C:\mingw-w64\mingw32\bin&quot; on 32-bit)</p>
<p>Install <a href="https://gitforwindows.org/">Git for Windows</a> and use a &quot;Git Bash&quot; shell to clone and build nimbus-eth2.</p>
<p>If you don't want to compile PCRE separately, you can fetch pre-compiled DLLs with:</p>
<pre><code class="language-bash">mingw32-make # this first invocation will update the Git submodules
mingw32-make fetch-dlls # this will place the right DLLs for your architecture in the &quot;build/&quot; directory
</code></pre>
<p>You can now follow the instructions in this this book by replacing <code>make</code> with <code>mingw32-make</code> (you should run <code>mingw32</code> regardless of whether you're running 32-bit or 64-bit architecture):</p>
<pre><code class="language-bash">mingw32-make test # run the test suite
</code></pre>
<h3><a class="header" href="#linux-macos" id="linux-macos">Linux, macOS</a></h3>
<p>After cloning the repo:</p>
<pre><code class="language-bash"># Build beacon_node and all the tools, using 4 parallel Make jobs
make -j4

# Run tests
make test

# Update to latest version
git pull
make update
</code></pre>
<p>To run a command that might use binaries from the Status Nim fork:</p>
<pre><code class="language-bash">./env.sh bash # start a new interactive shell with the right env vars set
which nim
nim --version # Nimbus is tested and supported on 1.0.2 at the moment

# or without starting a new interactive shell:
./env.sh which nim
./env.sh nim --version
</code></pre>
<h3><a class="header" href="#raspberry-pi" id="raspberry-pi">Raspberry Pi</a></h3>
<p>We recommend you remove any cover or use a fan; the Raspberry Pi will get hot (85¬∞C) and throttle.</p>
<ul>
<li>Raspberry PI 3b+ or Raspberry Pi 4b.</li>
<li>64gb SD Card (less might work too, but the default recommended 4-8GB will probably be too small)</li>
<li><a href="https://www.raspberrypi.org/downloads/raspbian/">Raspbian Buster Lite</a> - Lite version is enough to get going and will save some disk space!</li>
</ul>
<p>Assuming you're working with a freshly written image:</p>
<pre><code class="language-bash">
# Start by increasing swap size to 2gb:
sudo vi /etc/dphys-swapfile
# Set CONF_SWAPSIZE=2048
# :wq
sudo reboot

# Install prerequisites
sudo apt-get install git libgflags-dev libsnappy-dev libpcre3-dev

# Then you can follow instructions for Linux.

</code></pre>
<h3><a class="header" href="#makefile-tips-and-tricks-for-developers" id="makefile-tips-and-tricks-for-developers">Makefile tips and tricks for developers</a></h3>
<ul>
<li>build all those tools known to the Makefile:</li>
</ul>
<pre><code class="language-bash"># $(nproc) corresponds to the number of cores you have
make -j$(nproc)
</code></pre>
<ul>
<li>build a specific tool:</li>
</ul>
<pre><code class="language-bash">make state_sim
</code></pre>
<ul>
<li>you can control the Makefile's verbosity with the V variable (defaults to 0):</li>
</ul>
<pre><code class="language-bash">make V=1 # verbose
make V=2 test # even more verbose
</code></pre>
<ul>
<li>same for the <a href="https://github.com/status-im/nim-chronicles#chronicles_log_level">Chronicles log level</a>:</li>
</ul>
<pre><code class="language-bash">make LOG_LEVEL=DEBUG bench_bls_sig_agggregation # this is the default
make LOG_LEVEL=TRACE beacon_node # log everything
</code></pre>
<ul>
<li>pass arbitrary parameters to the Nim compiler:</li>
</ul>
<pre><code class="language-bash">make NIMFLAGS=&quot;-d:release&quot;
</code></pre>
<ul>
<li>you can freely combine those variables on the <code>make</code> command line:</li>
</ul>
<pre><code class="language-bash">make -j$(nproc) NIMFLAGS=&quot;-d:release&quot; USE_MULTITAIL=yes eth2_network_simulation
</code></pre>
<ul>
<li>don't use the <a href="https://github.com/status-im/nimbus-eth2/pull/745">lightweight stack tracing implementation from nim-libbacktrace</a>:</li>
</ul>
<pre><code class="language-bash">make USE_LIBBACKTRACE=0 # expect the resulting binaries to be 2-3 times slower
</code></pre>
<h3><a class="header" href="#multi-client-interop-scripts" id="multi-client-interop-scripts">Multi-client interop scripts</a></h3>
<p><a href="https://github.com/eth2-clients/multinet">This repository</a> contains a set of scripts used by the client implementation teams to test interop between the clients (in certain simplified scenarios). It mostly helps us find and debug issues.</p>
<h1><a class="header" href="#set-up-a-systemd-service" id="set-up-a-systemd-service">Set up a systemd service</a></h1>
<p>This page will take you through how to set up a <code>systemd</code> service for your beacon node.</p>
<blockquote>
<p><a href="https://www.freedesktop.org/wiki/Software/systemd/"><code>systemd</code></a> is a service manager designed specifically for Linux. There is no port to Mac OS.</p>
</blockquote>
<h2><a class="header" href="#prerequisites-3" id="prerequisites-3">Prerequisites</a></h2>
<p>NBC's <a href="./install.html#external-dependencies">external dependencies</a> and a working <a href="https://golang.org/doc/install">Go</a> installation (v1.11 or later).</p>
<h3><a class="header" href="#1-clone-repositories" id="1-clone-repositories">1. Clone repositories</a></h3>
<p>Clone the <a href="https://github.com/status-im/nimbus-eth2">nimbus-eth2</a> and <a href="https://github.com/Alethio/eth2stats-client">eth2stats</a> repositories in the same directory (so that both repositories are adjacent to each other).</p>
<pre><code class="language-console">git clone https://github.com/status-im/nimbus-eth2.git
git clone https://github.com/Alethio/eth2stats-client.git
</code></pre>
<h3><a class="header" href="#2-build-repositories" id="2-build-repositories">2. Build repositories</a></h3>
<p>Build both repositories by following their respective build instructions. </p>
<p><em>nimbus-eth2</em></p>
<pre><code class="language-console">cd nimbus-eth2
make beacon_node
</code></pre>
<p><em>eth2stats</em></p>
<pre><code class="language-console">cd eth2stats-client
make build
</code></pre>
<p>The resulting binaries should appear in <code>nimbus-eth2/build/beacon_node</code> and <code>eth2stats-client/eth2stats-client</code>, respectively.</p>
<h3><a class="header" href="#3-create-an-executable-script" id="3-create-an-executable-script">3. Create an executable script</a></h3>
<p>Create an executable script, <code>run_nimbus_node.sh</code>, and place it adjacent to the repositories you cloned in step 1 (same directory level).</p>
<pre><code class="language-bash">#!/bin/bash

set +e

trap &quot;trap - SIGTERM &amp;&amp; kill -- -$$&quot; SIGINT SIGTERM EXIT

cd $(dirname &quot;$0&quot;)
cd nimbus-eth2

NETWORK=$1
NODE_NAME=${NODE_NAME:-$(whoami)}

if [[ &quot;$2&quot; == &quot;&quot; ]]; then
  NODE_ID=0
else
  NODE_ID=$2
  NODE_NAME=$NODE_NAME-$2
fi

let METRICS_PORT=8008+${NODE_ID}
let RPC_PORT=9190+${NODE_ID}

# add your node to eth2stats and run a data collector app that connects to your beacon chain client
mkdir -p /tmp/${NODE_NAME}
../eth2stats-client/eth2stats-client run \
  --data.folder=/tmp/${NODE_NAME} \
  --eth2stats.node-name=&quot;${NODE_NAME}&quot; \
  --eth2stats.addr=&quot;grpc.${NETWORK}.eth2stats.io:443&quot; --eth2stats.tls=true \
  --beacon.type=&quot;nimbus&quot; \
  --beacon.addr=&quot;http://localhost:$RPC_PORT&quot; \
  --beacon.metrics-addr=&quot;http://localhost:$METRICS_PORT/metrics&quot; &gt; /tmp/ethstats.$NODE_NAME.log 2&gt;&amp;1 &amp;

# build and run the beacon node
make NIMFLAGS=&quot;-d:insecure&quot; NODE_ID=$NODE_ID ${NETWORK}
</code></pre>
<blockquote>
<p>Tip: don't forget to mark the script as executable by running <code>chmod +x</code> on it.</p>
</blockquote>
<h3><a class="header" href="#4-create-a-systemd-service-unit-file" id="4-create-a-systemd-service-unit-file">4. Create a systemd service unit file</a></h3>
<p>Create a <code>systemd</code> service unit file, <code>nbc.service</code>, and save it in <code>/etc/systemd/system/</code>.</p>
<pre><code class="language-txt">[Unit]
Description=Nimbus beacon node

[Service]
ExecStart=&lt;BASE-DIRECTORY&gt;/run_nimbus_node.sh medalla
User=&lt;USERNAME&gt;
Group=&lt;USERNAME&gt;
Restart=always
RuntimeMaxSec=10800

[Install]
WantedBy=default.target

</code></pre>
<p>Replace:</p>
<p><code>&lt;BASE-DIRECTORY&gt;</code> with the location of the repository in which you performed the <code>git clone</code> command in step 1.</p>
<p><code>&lt;USERNAME&gt;</code> with the username of the system user responsible for running the launched processes.</p>
<h3><a class="header" href="#5-notify-systemd-of-the-newly-added-service" id="5-notify-systemd-of-the-newly-added-service">5. Notify systemd of the newly added service</a></h3>
<pre><code class="language-console">sudo systemctl daemon-reload
</code></pre>
<h3><a class="header" href="#6-start-the-nim-beacon-chain-service" id="6-start-the-nim-beacon-chain-service">6. Start the nim beacon chain service</a></h3>
<pre><code class="language-console">sudo systemctl enable nbc --now
</code></pre>
<h1><a class="header" href="#frequently-asked-questions" id="frequently-asked-questions">Frequently Asked Questions</a></h1>
<h2><a class="header" href="#nimbus" id="nimbus">Nimbus</a></h2>
<h3><a class="header" href="#why-are-metrics-not-working" id="why-are-metrics-not-working">Why are metrics not working?</a></h3>
<p>Metrics are currently implemented using a HTTP server that hasn't been hardened sufficiently (which means it can't be exposed as a public endpoint). It must therefore be enabled specifically during build:</p>
<pre><code>make NIMFLAGS=&quot;-d:insecure&quot; beacon_node --metrics ...
</code></pre>
<h2><a class="header" href="#validating" id="validating">Validating</a></h2>
<h3><a class="header" href="#what-exactly-is-a-validator" id="what-exactly-is-a-validator">What exactly is a validator?</a></h3>
<p>A validator is an entity that participates in the consensus of the Ethereum 2.0 protocol.</p>
<p>Or in plain english, a human running a computer process. This process proposes and vouches for new blocks to be added to the blockchain.</p>
<p>In other words, <strong>you can think of a validator as a voter for new blocks.</strong> The more votes a block gets, the more likely it is to be added to the chain.</p>
<p>Importantly, a validator's vote is weighted by the amount it has at stake.</p>
<h3><a class="header" href="#what-is-the-deposit-contract" id="what-is-the-deposit-contract">What is the deposit contract?</a></h3>
<p>You can think of it as a transfer of funds between Ethereum 1.0 accounts and Ethereum 2.0 validators.</p>
<p>It specifies who is staking, who is validating, how much is being staked, and who can withdraw the funds.</p>
<h3><a class="header" href="#why-do-validators-need-to-have-funds-at-stake" id="why-do-validators-need-to-have-funds-at-stake">Why do validators need to have funds at stake?</a></h3>
<p>Validators need to have funds at stake so they can be penalized for behaving dishonestly.</p>
<p>In other words, to keep them honest, their actions need to have financial consequences.</p>
<h3><a class="header" href="#how-much-eth-does-a-validator-need-to-stake" id="how-much-eth-does-a-validator-need-to-stake">How much ETH does a validator need to stake?</a></h3>
<p>Before a validator can start to secure the network, he or she needs to stake <strong>32 ETH</strong>. This forms the validator's initial balance.</p>
<h3><a class="header" href="#is-there-any-advantage-to-having-more-than-32-eth-at-stake" id="is-there-any-advantage-to-having-more-than-32-eth-at-stake">Is there any advantage to having more than 32 ETH at stake?</a></h3>
<p>No. There is no advantage to having more than 32 ETH staked. </p>
<p>Limiting the maximum stake to 32 ETH encourages decentralization of power as it prevents any single validator from having an excessively large vote on the state of the chain.</p>
<blockquote>
<p>Remember that a validator‚Äôs vote is weighted by the amount it has at stake.</p>
</blockquote>
<h2><a class="header" href="#can-i-stop-my-validator-for-a-few-days-and-then-start-it-back-up-again" id="can-i-stop-my-validator-for-a-few-days-and-then-start-it-back-up-again">Can I stop my validator for a few days and then start it back up again?</a></h2>
<p>Yes but, under normal conditions, you will lose an amount of ETH roughly equivalent to the amount of ETH you would have gained in that period. In other words, if you stood to earn ‚âà0.01 ETH, you would instead be penalised ‚âà0.01 ETH.</p>
<h2><a class="header" href="#when-should-i-top-up-my-validators-balance" id="when-should-i-top-up-my-validators-balance">When should I top up my validator's balance?</a></h2>
<p>The answer to this question very much depends on how much ETH you have at your disposal.</p>
<p>You should certainly top up if your balance is close to 16 ETH: this is to ensure you don't get removed from the validator set (which automatically happens if your balance falls below 16 ETH).</p>
<p>At the other end of the spectrum, if your balance is closer to 31 ETH, it's probably not worth your while adding the extra ETH required to get back to 32.</p>
<h2><a class="header" href="#when-can-i-withdraw-my-funds-and-whats-the-difference-between-exiting-and-withdrawing" id="when-can-i-withdraw-my-funds-and-whats-the-difference-between-exiting-and-withdrawing">When can I withdraw my funds, and what's the difference between exiting and withdrawing?</a></h2>
<p>You can signal your intent to stop validating by signing a voluntary exit message with your validator. </p>
<p>However, bear in mind that in Phase 0, once you've exited, there's no going back.</p>
<p>There's no way for you to activate your validator again, and you won't be able to transfer or withdraw your funds until at least Phase 1.5 (which means your funds will remain inaccessible until then).</p>
<h3><a class="header" href="#how-are-validators-incentivized-to-stay-active-and-honest" id="how-are-validators-incentivized-to-stay-active-and-honest">How are validators incentivized to stay active and honest?</a></h3>
<p>In addition to being penalized for being offline, validators are penalized for behaving maliciously ‚Äì for example attesting to invalid or contradicting blocks.</p>
<p>On the other hand, they are rewarded for proposing / attesting to blocks that are included in the chain.</p>
<p>The key concept is the following:</p>
<ul>
<li>Rewards are given for actions that help the network reach consensus</li>
<li>Minor penalties are given for inadvertant actions (or inactions) that hinder consensus</li>
<li>And major penalities -- or <strong>slashings</strong> -- are given for malicious actions</li>
</ul>
<p>In other words, validators that maximize their rewards also provide the greatest benefit to the network as a whole.</p>
<h3><a class="header" href="#how-are-rewardspenalties-issued" id="how-are-rewardspenalties-issued">How are rewards/penalties issued?</a></h3>
<p>Remember that each validator has its own balance -- with the initial balance outlined in the deposit contract.</p>
<p>This balance is updated periodically by the Ethereum network rules as the validator carries (or fails to carry) out his or her responsibilities.</p>
<p>Put another way, rewards and penalties are reflected in the validator's balance over time.</p>
<h3><a class="header" href="#how-often-are-rewardspenalties-issued" id="how-often-are-rewardspenalties-issued">How often are rewards/penalties issued?</a></h3>
<p>Approximately every six and a half minutes -- a period of time known as an epoch.</p>
<p>Every epoch, the network measures the actions of each validator and issues rewards or penalties appropriately.</p>
<h3><a class="header" href="#how-large-are-the-rewardspenalties" id="how-large-are-the-rewardspenalties">How large are the rewards/penalties?</a></h3>
<p>There is no easy answer to this question as there are many factors that go into this calculation.</p>
<p>Arguably the most impactful factor on rewards earned for validating transactions is the total amount of stake in the network. In other words, the total amount of validators. Depending on this figure the max annual return rate for a validator can be anywhere between 2 and 20%.</p>
<p>Given a fixed total number of validators, the rewards/penalties predominantly scale with the balance of the validator -- attesting with a higher balance results in larger rewards/penalties whereas attesting with a lower balance results in lower rewards/penalties.</p>
<blockquote>
<p>Note however that this scaling mechanism works in a non-obvious way. To understand the precise details of how it works requires understanding a concept called <strong>effective balance</strong>. If you're not yet familiar with this concept, we recommend you read through this <a href="https://www.attestant.io/posts/understanding-validator-effective-balance/">excellent post</a>.</p>
</blockquote>
<h3><a class="header" href="#why-do-rewards-depend-on-the-total-number-of-validators-in-the-network" id="why-do-rewards-depend-on-the-total-number-of-validators-in-the-network">Why do rewards depend on the total number of validators in the network?</a></h3>
<p>Block rewards are calculated using a sliding scale based on the total amount of ETH staked on the network.</p>
<p>In plain english: if the total amount of ETH staked is low, the reward (interest rate) is high, but as the total stake rises, the reward (interest) paid out to each validator starts to fall.</p>
<p>Why a sliding scale? While we won't get into the gory details here, the basic intution is that there needs to be a minimum number of validators (and hence a minimum amount of ETH staked) for the network to function properly. So, to incentivize more validators to join, it's important that the interest rate remains high until this minimum number is reached.</p>
<p>Afterwards, validators are still encouraged to join (the more validators the more decentralized the network), but it's not absolutely essential that they do so (so the interest rate can fall).</p>
<h3><a class="header" href="#how-badly-will-a-validator-be-penalized-for-being-offline" id="how-badly-will-a-validator-be-penalized-for-being-offline">How badly will a validator be penalized for being offline?</a></h3>
<p>It depends. In addition to <a href="https://www.attestant.io/posts/understanding-validator-effective-balance/#the-impact-of-effective-balance-on-validating">the impact of effective balance</a> there are two important scenarios to be aware of:</p>
<ol>
<li>
<p>Being offline while a supermajority (2/3) of validators is still online leads to relatively small penalties as there are still enough validators online for the chain to finalize. <strong>This is the expected scenario.</strong></p>
</li>
<li>
<p>Being offline at the same time as more than 1/3 of the total number of validators leads to harsher penalties, since blocks do not finalize anymore. <strong>This scenario is very extreme and unlikely to happen.</strong></p>
</li>
</ol>
<blockquote>
<p>Note that in the second (unlikely) scenario, validators stand to progressively lose up to 50% (16 ETH) of their stake over 21 days. After 21 days they are ejected out of the validator pool. This ensures that blocks start finalizing again at some point.</p>
</blockquote>
<h3><a class="header" href="#how-great-does-an-honest-validators-uptime-need-to-be-for-it-to-be-net-profitable" id="how-great-does-an-honest-validators-uptime-need-to-be-for-it-to-be-net-profitable">How great does an honest validator's uptime need to be for it to be net profitable?</a></h3>
<p>Overall, validators are expected to be net profitable as long as their uptime is <a href="https://blog.ethereum.org/2020/01/13/validated-staking-on-eth2-1-incentives/">greater than 50%</a>. </p>
<p>This means that validators need not go to extreme lengths with backup clients or redundant internet connections as the repercussions of being offline are not so severe.</p>
<h3><a class="header" href="#how-much-will-a-validator-be-penalized-for-acting-maliciously" id="how-much-will-a-validator-be-penalized-for-acting-maliciously">How much will a validator be penalized for acting maliciously?</a></h3>
<p>Again, it depends. Behaving maliciously ‚Äì for example attesting to invalid or contradicting blocks, will lead to a validator's stake being slashed.</p>
<p>The minimum amount that can be slashed is 1 ETH, but <strong>this number increases if other validators are slashed at the same time.</strong></p>
<p>The idea behind this is to minimize the losses from honest mistakes, but strongly disincentivize coordinated attacks.</p>
<h3><a class="header" href="#what-exactly-is-slashing" id="what-exactly-is-slashing">What exactly is slashing?</a></h3>
<p>Slashing has two purposes: (1) to make it prohibitively expensive to attack eth2, and (2) to stop validators from being lazy by checking that they actually perform their duties. Slashing a validator is to destroy (a portion of) the validator‚Äôs stake if they act in a provably destructive manner. </p>
<p>Validators that are slashed are prevented from participating in the protocol further and are forcibly exited.</p>
<h3><a class="header" href="#what-happens-i-lose-my-signing-key" id="what-happens-i-lose-my-signing-key">What happens I lose my signing key?</a></h3>
<p>If the signing key is lost, the validator can no longer propose or attest.</p>
<p>Over time, the validator's balance will decrease as he or she is punished for not participating in the consensus process. When the validator's balance reaches 16 Eth, he or she will be automatically exited from the validator pool.</p>
<blockquote>
<p>However, all is not lost. Assuming validators derive their keys using <a href="https://eips.ethereum.org/EIPS/eip-2334">EIP2334</a> (as per the default onboarding flow)then <strong>validators can always recalculate their signing key from their withdrawal key</strong>.</p>
</blockquote>
<p>The 16 Eth can then be withdrawn -- with the withdrawal key -- after a delay of around a day.</p>
<blockquote>
<p>Note that this delay can be longer if many others are exiting or being kicked out at the same time.</p>
</blockquote>
<h3><a class="header" href="#what-happens-if-i-lose-my-withdrawal-key" id="what-happens-if-i-lose-my-withdrawal-key">What happens if I lose my withdrawal key?</a></h3>
<p>If the withdrawal key is lost, there is no way to obtain access to the funds held by the validator.</p>
<p>As such, it's a good idea to create your keys from mnemonics which act as another backup. This will be the default for validators who join via this site's onboarding process.</p>
<h3><a class="header" href="#what-happens-if-my-withdrawal-key-is-stolen" id="what-happens-if-my-withdrawal-key-is-stolen">What happens if my withdrawal key is stolen?</a></h3>
<p>If the withdrawal key is stolen, the thief can transfer the validator‚Äôs balance, but only once the validator has exited.</p>
<p>If the signing key is not under the thief‚Äôs control, the thief cannot exit the validator. </p>
<p>The user with the signing key could attempt to quickly exit the validator and then transfer the funds -- with the withdrawal key -- before the thief.</p>
<h3><a class="header" href="#why-two-keys-instead-of-one" id="why-two-keys-instead-of-one">Why two keys instead of one?</a></h3>
<p>In a nutshell, security. The signing key must be available at all times. As such, it will need to be held online. Since anything online is vulnerable to being hacked, it's not a good idea to use the same key for withdrawals.</p>
<h1><a class="header" href="#contribute" id="contribute">Contribute</a></h1>
<p>Follow these steps to contribute to this book!</p>
<p>We use an utility tool called mdBook to create online books from Markdown files.</p>
<h2><a class="header" href="#before-you-start" id="before-you-start">Before You Start</a></h2>
<ol>
<li>Install mdBook from <a href="https://github.com/rust-lang/mdBook">here</a>.</li>
<li>Clone the repository by <code>git clone https://github.com/status-im/nimbus-eth2.git</code>.</li>
<li>Go to where the Markdown files are located by <code>cd docs</code>.</li>
</ol>
<h2><a class="header" href="#real-time-update-and-preview-changes" id="real-time-update-and-preview-changes">Real-Time Update and Preview Changes</a></h2>
<ol>
<li>Run <code>mdbook serve</code> in the terminal.</li>
<li>Preview the book at <a href="http://localhost:3000">http://localhost:3000</a>.</li>
</ol>
<h2><a class="header" href="#build-and-deploy" id="build-and-deploy">Build and Deploy</a></h2>
<p>The first step is to submit a pull request to the <a href="https://github.com/status-im/nimbus-eth2/tree/devel">devel branch</a>.
Then, after it is merged, do the following under our main repository:</p>
<ol>
<li><code>cd nimbus-eth2</code></li>
<li><code>git checkout devel</code></li>
<li><code>git pull</code></li>
<li><code>make update</code> (This is to update the submodules to the latest version)</li>
<li><code>make publish-book</code></li>
</ol>
<h2><a class="header" href="#trouble-shooting" id="trouble-shooting">Trouble Shooting</a></h2>
<p>If you see file conflicts in the pull request, this may due to that you have created your new branch from an old version of the <code>devel</code> branch. Update your new branch using the following commands:</p>
<pre><code>git checkout devel
git pull
make update
git checkout readme
git merge devel
# use something like `git mergetool` to resolve conflicts, then read the instructions for completing the merge (usually just a `git commit`)
# check the output of `git diff devel`
</code></pre>
<p>Thank you so much for your help to the decentralized and open source community. :)</p>
<h1><a class="header" href="#resources" id="resources">Resources</a></h1>
<ul>
<li>
<p><a href="https://discord.com/invite/e84CFep">ethstaker discord</a>: great place for tips and discussions</p>
</li>
<li>
<p><a href="https://medalla.launchpad.ethereum.org">Validator launchpad</a>: to send Medalla deposits </p>
</li>
<li>
<p><a href="https://zinken.beaconcha.in/">Beacon chain explorer</a> : to monitor testnet health </p>
</li>
<li>
<p><a href="https://discord.com/invite/XRxWahP">Nimbus discord</a> : best place to ask questions and to stay up-to-date with critical updates</p>
</li>
<li>
<p><a href="https://www.reddit.com/r/ethereum/comments/gf3nhg/ethereum_on_arm_raspberry_pi_4_images_release/">Ethereum on ARM: Raspberry Pi 4 image + tutorial</a> : turn your Raspberry Pi 4 into an eth1 or eth2 node just by flashing the MicroSD card</p>
</li>
</ul>
<h1><a class="header" href="#become-a-zinken-validator" id="become-a-zinken-validator">Become a Zinken validator</a></h1>
<p>This page will take you through how to import your key(s) and get your validator(s) ready for <a href="https://blog.ethereum.org/2020/09/22/eth2-quick-update-no-17/">Zinken genesis</a>.</p>
<p>For those of you who are unfamiliar, <a href="https://github.com/goerli/medalla/blob/master/zinken/README.md">Zinken</a> is a short-lived eth2 testnet that will begin on <strong>Monday, October 12th at 12 UTC</strong> and last for three days or so. Its main objective is to allow us to test the deposit/<a href="https://hackmd.io/@benjaminion/genesis">genesis</a> flow one more time before mainnet launch.</p>
<p>Although it will mainly be client teams taking part, it's also a chance for you to practice sending a deposit and launching a node under mainnet launch conditions (in order to avoid clogging up the validator queue, we recommend practicing with one, or at most a handful of validators).</p>
<h2><a class="header" href="#prerequisites-4" id="prerequisites-4">Prerequisites</a></h2>
<blockquote>
<p>‚ö†Ô∏è If this is your first time playing with Nimbus, please make sure you <a href="./install.html">install our external dependencies</a> first.</p>
</blockquote>
<p>This tutorial assumes basic knowledge of the <a href="https://www.learnenough.com/command-line-tutorial/basics#:%7E:text=Learn%20Enough%20Command%20Line%20to%20Be%20Dangerous%20is%20an%20introduction,broad%20an%20audience%20as%20possible.">command line</a>.</p>
<h2><a class="header" href="#1-make-a-deposit" id="1-make-a-deposit">1. Make a deposit</a></h2>
<p>The easiest way to get your deposit in is to follow the Launchpad instructions here:</p>
<p><a href="https://zinken.launchpad.ethereum.org/">https://zinken.launchpad.ethereum.org/</a></p>
<p>You should notice that there have been considerable improvements to the launchpad process since Medalla.</p>
<p>In particular, the Key Generation section is now much clearer, and you no longer have to install dependencies to get the command line app working. As such, it should now be much easier for non-technical folks to generate their key(s).</p>
<p><img src="https://i.imgur.com/slELPmk.png" alt="" /></p>
<p>Once you've sent off your transaction, you should see the following screen.</p>
<p><img src="https://i.imgur.com/A4IMlhK.png" alt="" /></p>
<p>Click on <code>Beaconchain</code> to open up a window that will allow you to track of your validator's status.</p>
<p><img src="https://i.imgur.com/JHQblna.png" alt="" /></p>
<h2><a class="header" href="#2-import-your-keys" id="2-import-your-keys">2. Import your key(s)</a></h2>
<p>To import your <code>zinken</code> key(s) into Nimbus:</p>
<blockquote>
<p><strong>Note:</strong> You can skip steps 1 and 2 below if you've already cloned <code>nimbus-eth2</code> and built the beacon node for <code>medalla</code>: just make sure you run <code>git pull &amp;&amp; make update</code> from the <code>master</code> branch before continuing with step 3.</p>
</blockquote>
<h4><a class="header" href="#1-clone-the-nim-beacon-chain-repository-1" id="1-clone-the-nim-beacon-chain-repository-1">1. Clone the nim beacon chain repository</a></h4>
<pre><code>git clone https://github.com/status-im/nimbus-eth2
cd nimbus-eth2
</code></pre>
<h4><a class="header" href="#2-build-the-beacon-node" id="2-build-the-beacon-node">2. Build the beacon node</a></h4>
<pre><code>make beacon_node
</code></pre>
<p><em>Patience... this may take a few minutes.</em></p>
<h4><a class="header" href="#3-import-keystores" id="3-import-keystores">3. Import keystore(s)</a></h4>
<pre><code>build/beacon_node deposits import  --data-dir=build/data/shared_zinken_0 &lt;YOUR VALIDATOR KEYS DIRECTORY&gt;
</code></pre>
<p>Replacing <code>&lt;YOUR VALIDATOR KEYS DIRECTORY&gt;</code> with the full pathname of the <code>validator_keys</code> directory that was created when you generated your keys using the <a href="https://zinken.launchpad.ethereum.org/">Zinken Launchpad</a> <a href="https://github.com/ethereum/eth2.0-deposit-cli/releases/">command line app</a>.</p>
<blockquote>
<p><strong>Tip:</strong> run <code>pwd</code> in your <code>validator_keys</code> directory to print the full pathname to the console.</p>
</blockquote>
<p>You'll be asked to enter the password you created to encrypt your keystore(s).</p>
<p>Don't worry, this is entirely normal. Your validator client needs both your signing keystore(s) and the password encrypting it to import your <a href="https://blog.ethereum.org/2020/05/21/keys/">key</a> (since it needs to decrypt the keystore in order to be able to use it to sign on your behalf).</p>
<h2><a class="header" href="#3-connect-to-zinken" id="3-connect-to-zinken">3. Connect to Zinken</a></h2>
<p>To build Nimbus and its dependencies, and connect to Zinken, run:</p>
<pre><code>make zinken
</code></pre>
<p>If you look near the top of the logs printed to your console, you should see that your beacon node has started, with your local validator attached:</p>
<pre><code>INF 2020-10-07 17:04:09.213+02:00 Initializing networking                    topics=&quot;networking&quot; tid=11688398 file=eth2_network.nim:1335 hostAddress=/ip4/0.0.0.0/tcp/9000 network_public_key=0802122102defb020c8e47dd8f5da89f51ed6c3998aaa0dd59eeb2784e29d47fdbdab69235 announcedAddresses=@[/ip4/195.177.101.93/tcp/9000]
WRN 2020-10-07 17:04:09.215+02:00 Ignoring invalid bootstrap address         tid=11688398 file=eth2_discovery.nim:45 bootstrapAddr= reason=&quot;an empty string is not a valid bootstrap node&quot;
NOT 2020-10-07 17:04:09.231+02:00 Local validators attached                  topics=&quot;beacval&quot; tid=11688398 file=validator_duties.nim:65 count=0
NOT 2020-10-07 17:04:09.231+02:00 Starting beacon node                       topics=&quot;beacnde&quot; tid=11688398 file=beacon_node.nim:923 version=&quot;0.5.0 (1dec860b)&quot; nim=&quot;Nim Compiler Version 1.2.6 [MacOSX: amd64] (bf320ed1)&quot; timeSinceFinalization=0ns head=0814b036:0 finalizedHead=0814b036:0 SLOTS_PER_EPOCH=32 SECONDS_PER_SLOT=12 SPEC_VERSION=0.12.3 dataDir=build/data/shared_zinken_0
peers: 0 ‚ùØ finalized: 0814b036:0 ‚ùØ head: 0814b036:0:0 ‚ùØ time: 387:2 (12386) INF 2020-10-07 17:04:09.232+02:00 Starting discovery node                    topics=&quot;discv5&quot; tid=11688398 file=protocol.nim:799 node=Node[195.177.101.93:9000] uri=enr:-LK4QCje1Tb8tPIjuIWcAjVRprALNr-fGSmX0ijk2nt4-BgTRSG_q2oekHW9IxbdRi-bcT9RsppI7JtjIxjkm-dG9ZwBh2F0dG5ldHOI__________-EZXRoMpCEe0P1AAAAA___________gmlkgnY0gmlwhMCoC1OJc2VjcDI1NmsxoQLe-wIMjkfdj12on1HtbDmYqqDdWe6yeE4p1H_b2raSNYN0Y3CCIyiDdWRwgiMo bindAddress=0.0.0.0:9000 
</code></pre>
<blockquote>
<p><strong>Note:</strong> when you run <code>make zinken</code>, the beacon node launches with an Infura endpoint supplied by us. This endpoint is passed through the <code>web3-url</code> option (which takes as input the url of the web3 server from which you'd like to observe the eth1 chain). </p>
<p>Because Infura caps the requests per endpoint per day to 100k, and all Nimbus nodes use the same Infura endpoint by default, it can happen that our Infura endpoint is overloaded (i.e the requests on a given day reach the 100k limit). If this happens, all requests to Infura using the default endpoint will fail, which means your node will stop processing new deposits.</p>
<p>To pass in your own Infura endpoint, you'll need to run:</p>
<pre><code>make NODE_PARAMS=&quot;--web3-url=&lt;YOUR_WEBSOCKET_ENDPOINT&gt;&quot; medalla
</code></pre>
<p>Importantly, the endpoint must be a websocket (<code>wss</code>) endpoint, not <code>https</code>. If you're not familiar with Infura, we recommend reading through our <a href="./infura-guide">Infura guide</a>, first.</p>
<p>P.S. We are well aware that Infura is less than ideal from a decentralisation perspective. As such we are in the process of changing our default to <a href="https://geth.ethereum.org/docs/install-and-build/installing-geth">Geth</a> (with Infura as a fallback). For some rough notes on how to use Geth with Nimbus, see <a href="https://gist.github.com/onqtam/aaf883d46f4dab1311ca9c160df12fe4">here</a> (we will be adding more complete instructions very soon).</p>
</blockquote>
<h2><a class="header" href="#4-keep-an-eye-on-your-validator" id="4-keep-an-eye-on-your-validator">4. Keep an eye on your validator</a></h2>
<p>If you deposit after the <a href="https://hackmd.io/@benjaminion/genesis">genesis</a> state was decided (October 8th, 12pm UTC), your validators will be put in a queue based on deposit time, and will slowly be inducted into the validator set after genesis. Getting through the queue may take a few hours or a day or so.</p>
<p>The best way to keep track of your validator's status is <a href="https:/zinken.beaconcha.in">zinken.beaconcha.in</a> (click on the orange magnifying glass at the very top and paste in your validator's public key).</p>
<p>You can even <a href="https://zinken.beaconcha.in/register">create an account</a> to add alerts and keep track of your validator's <a href="https://zinken.beaconcha.in/dashboard">performance</a>.</p>
<p>Finally, makes sure you stay on the lookout for any critical updates to Nimbus. This best way to do so is through the <strong>announcements</strong> channel on our <a href="https://discord.com/invite/XRxWahP">discord</a>.</p>
<p>To update to the latest version, disconnect from <code>zinken</code> and run:</p>
<pre><code>git pull &amp;&amp; make update
</code></pre>
<p>Once the update is complete, run <code>make zinken</code> again to reconnect to the network.</p>
<p>Looking forward to seeing you on Zinken! üíõ</p>
<hr />
<h2><a class="header" href="#key-management" id="key-management">Key management</a></h2>
<p>Keys are stored in the <code>build/data/shared_zinken_0/</code> folder, under <code>secrets</code> and <code>validators</code> - make sure you keep these folders backed up.</p>
<p>The <code>secrets</code> folder contains the common secret that gives you access to all your validator keys.</p>
<p>The <code>validators</code> folder contains your signing keystore(s) (encrypted keys). Keystores are used by validators as a method for exchanging keys. For more on keys and keystores, see <a href="https://blog.ethereum.org/2020/05/21/keys/">here</a>.</p>
<blockquote>
<p><strong>Note:</strong> The Nimbus client will only ever import your signing key -- in any case, if you used the deposit launchpad, this is the only key you should have (thanks to the way these keys are derived, you can generate the withdrawal key from your mnemonic whenever you wish to withdraw).</p>
</blockquote>
<h2><a class="header" href="#metrics" id="metrics">Metrics</a></h2>
<p>Metrics are not included in the binary by default - to enable them, use the following options when starting the client:</p>
<pre><code>make NIMFLAGS=&quot;-d:insecure&quot; zinken
</code></pre>
<p>You can then browse the metrics by connecting to:</p>
<p><a href="http://localhost:8008/metrics">http://localhost:8008/metrics</a></p>
<p>Make sure this port is protected as the http server used is not considered secure (it should not be used by untrusted peers).</p>
<p>For instructions on how to spin up a beautiful and useful monitoring dashboard for your validator and beacon node, see <a href="./metrics-pretty-pictures.html">this page</a> (note you'll need to replace all mention of <code>medalla</code> with <code>zinken</code>).</p>
<h2><a class="header" href="#advanced-options-1" id="advanced-options-1">Advanced options</a></h2>
<p>N.B. All the options you're used to running with <code>medalla</code> should work as expected with <code>zinken</code>.</p>
<h3><a class="header" href="#change-the-tcp-and-udp-ports-1" id="change-the-tcp-and-udp-ports-1">Change the TCP and UDP ports</a></h3>
<p>To change the TCP and UDP ports from their default value of 9000 to 9100, say, run:</p>
<pre><code>make BASE_PORT=9100 zinken
</code></pre>
<p>You may need to do this if you are running another client.</p>
<h3><a class="header" href="#node-parameters-1" id="node-parameters-1">Node parameters</a></h3>
<p>You can customise your beacon node's parameters using the <code>NODE_PARAMS</code> option:</p>
<pre><code>make NODE_PARAMS=&quot;--tcp-port=9100 --udp-port=9100&quot; zinken
</code></pre>
<blockquote>
<p><strong>Note:</strong> the above command has exactly the same effect as <code>make BASE_PORT=9100 zinken</code></p>
</blockquote>
<p>A complete list of the available parameters can be found <a href="https://github.com/status-im/nimbus-eth2/blob/devel/beacon_chain/conf.nim#L92-L210">here</a> (use a parameter's <code>name</code> field to set it).</p>
<h3><a class="header" href="#logs-1" id="logs-1">Logs</a></h3>
<p>Log files are saved in <code>build/data/shared_zinken_0/</code>.</p>
<h3><a class="header" href="#makefile-1" id="makefile-1">Makefile</a></h3>
<p>If you are comfortable reading <a href="https://en.wikipedia.org/wiki/Makefile#:%7E:text=A%20makefile%20is%20a%20file,to%20generate%20a%20target%2Fgoal">Makefiles</a>, you can see the commands that <code>make zinken</code>  executes under the hood, <a href="https://github.com/status-im/nimbus-eth2/blob/23bec993414df904e9d7ea9d26e65005b981aee0/Makefile#L184-L197">here</a>.</p>
<p>Some of the provided options (such as <code>--network</code>) are essential while others (such as the ones controlling logging, metrics, ports, and the RPC service) are optional and included for the sake convenience.</p>
<p>The Goerli testnet parameters (<code>$(GOERLI_TESTNETS_PARAMS</code>), are defined higher up in the Makefile, <a href="https://github.com/status-im/nimbus-eth2/blob/23bec993414df904e9d7ea9d26e65005b981aee0/Makefile#L164-L171">here</a>.</p>
<h2><a class="header" href="#useful-resources" id="useful-resources">Useful Resources</a></h2>
<ul>
<li>
<p><a href="https://discord.com/invite/e84CFep">ethstaker discord</a>: great place for tips and discussions</p>
</li>
<li>
<p><a href="https://zinken.launchpad.ethereum.org">Validator launchpad</a>: to send Zinken deposits </p>
</li>
<li>
<p><a href="https://zinken.beaconcha.in/">Beacon chain explorer</a> : to monitor testnet health </p>
</li>
<li>
<p><a href="https://discord.com/invite/XRxWahP">Nimbus discord</a> : best place to ask questions and to stay up-to-date with critical updates</p>
</li>
</ul>
<h1><a class="header" href="#become-a-medalla-validator" id="become-a-medalla-validator">Become a Medalla validator</a></h1>
<p>This chapter will take you through how to become a validator on the eth2 testnet <a href="https://github.com/goerli/medalla">Medalla</a>.</p>
<p>If you generated your signing key using the <a href="https://medalla.launchpad.ethereum.org/">eth2 launchpad</a>, and wish to import it into the Nimbus client, this page is for you.</p>
<blockquote>
<p>If you haven't created your validator key yet, we recommend you do so using the <a href="https://medalla.launchpad.ethereum.org/">launchpad</a>. If you're not sure what the eth2 launchpad is, we recommend reading this <a href="https://blog.ethereum.org/2020/07/27/eth2-validator-launchpad/">introductory post</a> first.</p>
</blockquote>
<blockquote>
<p>If you're an advanced user running Ubuntu, we recommend you check out this <a href="https://medium.com/@SomerEsat/guide-to-staking-on-ethereum-2-0-ubuntu-medalla-nimbus-5f4b2b0f2d7c">excellent and complementary guide</a>.</p>
</blockquote>
<h2><a class="header" href="#prerequisites-5" id="prerequisites-5">Prerequisites</a></h2>
<blockquote>
<p>‚ö†Ô∏è If this is your first time playing with Nimbus, please make sure you <a href="./install.html">install our external dependencies</a> first.</p>
</blockquote>
<p>This tutorial assumes basic knowledge of the <a href="https://www.learnenough.com/command-line-tutorial/basics#:%7E:text=Learn%20Enough%20Command%20Line%20to%20Be%20Dangerous%20is%20an%20introduction,broad%20an%20audience%20as%20possible.">command line</a>.</p>
<h2><a class="header" href="#validating-1" id="validating-1">Validating</a></h2>
<p>To start validating on the <code>medalla</code> network:</p>
<h4><a class="header" href="#1-clone-the-nim-beacon-chain-repository-2" id="1-clone-the-nim-beacon-chain-repository-2">1. Clone the nim beacon chain repository</a></h4>
<pre><code>git clone https://github.com/status-im/nimbus-eth2
cd nimbus-eth2
</code></pre>
<h4><a class="header" href="#2-build-the-beacon-node-1" id="2-build-the-beacon-node-1">2. Build the beacon node</a></h4>
<pre><code>make beacon_node
</code></pre>
<p><em>Patience... this may take a few minutes.</em></p>
<h4><a class="header" href="#3-import-keystores-1" id="3-import-keystores-1">3. Import keystore(s)</a></h4>
<pre><code>build/beacon_node deposits import  --data-dir=build/data/shared_medalla_0 &lt;YOUR VALIDATOR KEYS DIRECTORY&gt;
</code></pre>
<p>Replacing <code>&lt;YOUR VALIDATOR KEYS DIRECTORY&gt;</code> with the full pathname of your <code>validator_keys</code> directory.</p>
<blockquote>
<p>Tip: run <code>pwd</code> in your <code>validator_keys</code> directory to print the full pathname to the console.</p>
</blockquote>
<p>You'll be asked to enter the password you created to encrypt your keystore(s) in the <em>Generate Keys</em> section of the Launchpad process. Don't worry, this is entirely normal. Your validator client needs both your keystore(s) and the password encrypting it to import your <a href="https://blog.ethereum.org/2020/05/21/keys/">keys</a> (since it needs to decrypt the keystore in order to be able to use it to sign on your behalf).</p>
<h4><a class="header" href="#4-connect-to-medalla" id="4-connect-to-medalla">4. Connect to Medalla</a></h4>
<pre><code>make medalla
</code></pre>
<p>This will build Nimbus and its dependencies, and connect you to Medalla.
You should see that the beacon node has launched with your validator attached:</p>
<pre><code>WRN 2020-08-03 16:24:17.950+02:00 Validator not in registry (yet?)           topics=&quot;beacval&quot; tid=11677993 file=validator_duties.nim:53 pubKey=a9c4df36
INF 2020-08-03 16:24:17.951+02:00 Local validator attached                   tid=11677993 file=validator_pool.nim:21 pubKey=a9c4df36 validator=a9c4df36
INF 2020-08-03 16:24:17.951+02:00 Local validators attached                  topics=&quot;beacval&quot; tid=11677993 file=validator_duties.nim:61 count=1
INF 2020-08-03 16:24:17.958+02:00 Starting beacon node                       topics=&quot;beacnde&quot; tid=11677993 file=beacon_node.nim:875 version=&quot;0.5.0 (31b33907)&quot; nim=&quot;Nim Compiler Version 1.2.6 [MacOSX: amd64] (bf320ed1)&quot; timeSinceFinalization=81350 head=ebe49843:0 finalizedHead=ebe49843:0 SLOTS_PER_EPOCH=32 SECONDS_PER_SLOT=12 SPEC_VERSION=0.12.2 dataDir=build/data/shared_medalla_0 pcs=start_beacon_node
</code></pre>
<blockquote>
<p><strong>Note:</strong> when you run <code>make medalla</code>, the beacon node launches with an Infura endpoint supplied by us. This endpoint is passed through the <code>web3-url</code> option (which takes as input the url of the web3 server from which you'd like to observe the eth1 chain). </p>
<p>Because Infura caps the requests per endpoint per day to 100k, and all Nimbus nodes use the same Infura endpoint by default, it can happen that our Infura endpoint is overloaded (i.e the requests on a given day reach the 100k limit). If this happens, all requests to Infura using the default endpoint will fail, which means your node will stop processing new deposits.</p>
<p>To pass in your own Infura endpoint, you'll need to run:</p>
<pre><code>make NODE_PARAMS=&quot;--web3-url=&lt;YOUR_WEBSOCKET_ENDPOINT&gt;&quot; medalla
</code></pre>
<p>Importantly, the endpoint must be a websocket (<code>wss</code>) endpoint, not <code>https</code>. If you're not familiar with Infura, we recommend reading through our <a href="./infura-guide">Infura guide</a>, first.</p>
<p>P.S. We are well aware that Infura is less than ideal from a decentralisation perspective. As such we are in the process of changing our default to <a href="https://geth.ethereum.org/docs/install-and-build/installing-geth">Geth</a> (with Infura as a fallback). For some rough notes on how to use Geth with Nimbus, see <a href="https://gist.github.com/onqtam/aaf883d46f4dab1311ca9c160df12fe4">here</a> (we will be adding more complete instructions very soon).</p>
</blockquote>
<blockquote>
<p><strong>Tip:</strong> to üé® on the <a href="https://medalla.beaconcha.in/graffitiwall">graffitwall</a>, pass the graffiti parameter like this:</p>
<pre><code>make NODE_PARAMS=&quot;--graffiti='&lt;YOUR_GRAFFITI&gt;'&quot; medalla
</code></pre>
</blockquote>
<h4><a class="header" href="#5-keep-an-eye-on-your-validator" id="5-keep-an-eye-on-your-validator">5. Keep an eye on your validator</a></h4>
<p>If you deposited after the <a href="https://hackmd.io/@benjaminion/genesis">genesis</a> state was decided (August 2nd 1300 UTC), your validators will have been put in a queue based on deposit time, and will slowly be inducted into the validator set after genesis. Getting through the queue may take a few hours or days.</p>
<p>The best way to keep track of your validator's status is <a href="https://medalla.beaconcha.in">medalla.beaconcha.in</a> (click on the orange magnifying glass at the very top and paste in its public key).</p>
<p>You can even <a href="https://medalla.beaconcha.in/register">create an account</a> to add alerts and keep track of your validator's <a href="https://medalla.beaconcha.in/dashboard">performance</a>.</p>
<p>To keep track of your syncing progress, have a look at the output at the very bottom of the terminal window in which your validator is running. You should see something like:</p>
<pre><code>peers: 35 ‚ùØ finalized: ada7228a:8765 ‚ùØ head: b2fe11cd:8767:2 ‚ùØ time: 9900:7 (316807) ‚ùØ sync: wPwwwwwDwwDPwPPPwwww:7:4.0627 (280512)
</code></pre>
<p>Where:</p>
<ul>
<li><code>peers</code> tells you how many peers you're currently connected to (in the above case, 35 peers)</li>
<li><code>finalized</code> tells you the most recent finalized epoch you've synced to so far (the 8765th epoch)</li>
<li><code>head</code> tells you the most recent slot you've synced to so far (the 2nd slot of the 8767th epoch)</li>
<li><code>time</code> tells you the current time since Genesis (the 7th slot of the 9900th epoch -- or equivalently, the 316,807th slot)</li>
<li><code>sync</code> tells you how fast you're syncing (4.0627 blocks per second), how many blocks you've synced so far (280,512), along with information about 20 sync workers linked to the 20 most performant peers you are currently connected to (represented by a string of letters and a number).</li>
</ul>
<p>To dig into <code>sync</code> a little:</p>
<pre><code>sync: &lt;sync worker map&gt;:&lt;number of active workers&gt;:&lt;current syncing speed in blocks/second&gt;
</code></pre>
<p>The string of letters -- what we call the <code>sync worker map</code> (in the above case represented by <code>wPwwwwwDwwDPwPPPwwww</code>) represents the status of the sync workers mentioned above, where:</p>
<pre><code>    s - sleeping (idle),
    w - waiting for a peer from PeerPool,
    R - requesting blocks from peer
    D - downloading blocks from peer
    P - processing/verifying blocks
    U - updating peer's status information
</code></pre>
<p>The number following it (in the above case represented by <code>7</code>) represents the number of workers that are currently active (i.e not sleeping or waiting for a peer).</p>
<h4><a class="header" href="#6-keep-your-validator-updated" id="6-keep-your-validator-updated">6. Keep your validator updated</a></h4>
<p>Finally, makes sure you stay on the lookout for any critical updates to Nimbus. This best way to do so is through the <strong>announcements</strong> channel on our <a href="https://discord.com/invite/XRxWahP">discord</a>.</p>
<p>To update to the latest version, disconnect from medalla and run:</p>
<pre><code>git pull &amp;&amp; make update
</code></pre>
<p>Once the update is complete, run <code>make medalla</code> to reconnect to the network.</p>
<p>Looking forward to seeing you on Medalla! üíõ</p>
<h2><a class="header" href="#key-management-1" id="key-management-1">Key management</a></h2>
<p>Keys are stored in the <code>build/data/shared_medalla_0/</code> folder, under <code>secrets</code> and <code>validators</code> - make sure you keep these folders backed up.</p>
<p>The <code>secrets</code> folder contains the common secret that gives you access to all your validator keys.</p>
<p>The <code>validators</code> folder contains your keystores (encrypted keys). Keystores are used by validators as a method for exchanging keys. For more on keys and keystores, see <a href="https://blog.ethereum.org/2020/05/21/keys/">here</a>.</p>
<blockquote>
<p><strong>Note:</strong> The Nimbus client will only ever import your signing key -- in any case, if you used the deposit launchpad, this is the only key you should have (you can generate the withdrawal key from your mnemonic when you wish to withdraw).</p>
</blockquote>
<h2><a class="header" href="#metrics-1" id="metrics-1">Metrics</a></h2>
<p>Metrics are not included in the binary by default - to enable them, use the following options when starting the client:</p>
<pre><code>make NIMFLAGS=&quot;-d:insecure&quot; medalla
</code></pre>
<p>You can then browse the metrics by connecting to:</p>
<p><a href="http://localhost:8008/metrics">http://localhost:8008/metrics</a></p>
<p>Make sure this port is protected as the http server used is not considered secure (it should not be used by untrusted peers).</p>
<p>For instructions on how to spin up a beautiful and useful monitoring dashboard for your validator and beacon node, see <a href="./metrics-pretty-pictures.html">this page</a>.</p>
<h2><a class="header" href="#advanced-options-2" id="advanced-options-2">Advanced options</a></h2>
<h3><a class="header" href="#start-multiple-nodes-1" id="start-multiple-nodes-1">Start multiple nodes</a></h3>
<p>You can start multiple local nodes, in different terminal windows/tabs, by specifying numeric IDs:</p>
<pre><code>make medalla NODE_ID=0 # the default
make medalla NODE_ID=1
make medalla NODE_ID=2
</code></pre>
<h3><a class="header" href="#attach-multiple-validators-to-the-same-beacon-node-1" id="attach-multiple-validators-to-the-same-beacon-node-1">Attach multiple validators to the same beacon node</a></h3>
<p>Simply <a href="./medalla.html#3-import-keystores">import as many keystores as you wish</a> before running <code>make medalla</code>. Nimbus will automagically find your keys and attach your validators. See <a href="./medalla.html#key-management">key management</a> for more information on where we store your keys.</p>
<p>To give you some context, we (the Nimbus team) are currently running 170 validators per beacon node on our AWS instances.</p>
<h3><a class="header" href="#change-the-tcp-and-udp-ports-2" id="change-the-tcp-and-udp-ports-2">Change the TCP and UDP ports</a></h3>
<p>To change the TCP and UDP ports from their default value of 9000 to 9100, say, run:</p>
<pre><code>make BASE_PORT=9100 medalla
</code></pre>
<p>You may need to do this if you are running another client.</p>
<h3><a class="header" href="#make-a-deposit-directly-using-nimbus-1" id="make-a-deposit-directly-using-nimbus-1">Make a deposit directly using Nimbus</a></h3>
<pre><code>make medalla-deposit VALIDATORS=2 # default is just 1
</code></pre>
<h3><a class="header" href="#node-parameters-2" id="node-parameters-2">Node parameters</a></h3>
<p>You can customise your beacon node's parameters using the <code>NODE_PARAMS</code> option:</p>
<pre><code>make NODE_PARAMS=&quot;--tcp-port=9100 --udp-port=9100&quot; medalla
</code></pre>
<blockquote>
<p><strong>Note:</strong> the above command has exactly the same effect as <code>make BASE_PORT=9100 medalla</code></p>
</blockquote>
<p>A complete list of the available parameters can be found <a href="https://github.com/status-im/nimbus-eth2/blob/devel/beacon_chain/conf.nim#L92-L210">here</a> (use a parameter's <code>name</code> field to set it).</p>
<h3><a class="header" href="#logs-2" id="logs-2">Logs</a></h3>
<p>Log files are saved in <code>build/data/shared_medalla_0/</code>.</p>
<h3><a class="header" href="#makefile-2" id="makefile-2">Makefile</a></h3>
<p>If you are comfortable reading <a href="https://en.wikipedia.org/wiki/Makefile#:%7E:text=A%20makefile%20is%20a%20file,to%20generate%20a%20target%2Fgoal">Makefiles</a>, you can see the commands that <code>make medalla</code>  executes under the hood, <a href="https://github.com/status-im/nimbus-eth2/blob/23bec993414df904e9d7ea9d26e65005b981aee0/Makefile#L184-L197">here</a>.</p>
<p>Some of the provided options (such as <code>--network=medalla</code>) are essential while others (such as the ones controlling logging, metrics, ports, and the RPC service) are there for convenience.</p>
<p>The Goerli testnet parameters (<code>$(GOERLI_TESTNETS_PARAMS</code>), are defined higher up in the Makefile, <a href="https://github.com/status-im/nimbus-eth2/blob/23bec993414df904e9d7ea9d26e65005b981aee0/Makefile#L164-L171">here</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
